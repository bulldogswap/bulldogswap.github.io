{"ast":null,"code":"import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _styled from\"styled-components\";import React,{useCallback,useEffect,useMemo,useRef,useState}from'react';import{brushX,select}from'd3';import{brushHandleAccentPath,brushHandlePath,OffScreenHandle}from'components/LiquidityChartRangeInput/svg';import usePrevious from'hooks/usePrevious';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Handle=_styled.path.withConfig({componentId:\"sc-1hckctp-0\"})([\"cursor:ew-resize;pointer-events:none;stroke-width:3;stroke:\",\";fill:\",\";\"],function(_ref){var color=_ref.color;return color;},function(_ref2){var color=_ref2.color;return color;});var HandleAccent=_styled.path.withConfig({componentId:\"sc-1hckctp-1\"})([\"cursor:ew-resize;pointer-events:none;stroke-width:1.5;stroke:\",\";opacity:0.6;\"],function(_ref3){var theme=_ref3.theme;return theme.white;});var LabelGroup=_styled.g.withConfig({componentId:\"sc-1hckctp-2\"})([\"opacity:\",\";transition:opacity 300ms;\"],function(_ref4){var visible=_ref4.visible;return visible?'1':'0';});var TooltipBackground=_styled.rect.withConfig({componentId:\"sc-1hckctp-3\"})([\"fill:\",\";\"],function(_ref5){var theme=_ref5.theme;return theme.bg2;});var Tooltip=_styled.text.withConfig({componentId:\"sc-1hckctp-4\"})([\"text-anchor:middle;font-size:13px;fill:\",\";\"],function(_ref6){var theme=_ref6.theme;return theme.text1;});// flips the handles draggers when close to the container edges\nvar FLIP_HANDLE_THRESHOLD_PX=20;// margin to prevent tick snapping from putting the brush off screen\nvar BRUSH_EXTENT_MARGIN_PX=2;var compare=function compare(a1,a2,xScale){return xScale(a1[0])!==xScale(a2[0])||xScale(a1[1])!==xScale(a2[1]);};export var Brush=function Brush(_ref7){var id=_ref7.id,xScale=_ref7.xScale,interactive=_ref7.interactive,brushLabelValue=_ref7.brushLabelValue,brushExtent=_ref7.brushExtent,setBrushExtent=_ref7.setBrushExtent,innerWidth=_ref7.innerWidth,innerHeight=_ref7.innerHeight,westHandleColor=_ref7.westHandleColor,eastHandleColor=_ref7.eastHandleColor;var brushRef=useRef(null);var brushBehavior=useRef(null);// only used to drag the handles on brush for performance\nvar _useState=useState(brushExtent),_useState2=_slicedToArray(_useState,2),localBrushExtent=_useState2[0],setLocalBrushExtent=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),showLabels=_useState4[0],setShowLabels=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),hovering=_useState6[0],setHovering=_useState6[1];var previousBrushExtent=usePrevious(brushExtent);var brushed=useCallback(function(event){var type=event.type,selection=event.selection,mode=event.mode;if(!selection){setLocalBrushExtent(null);return;}var scaled=selection.map(xScale.invert);// avoid infinite render loop by checking for change\nif(type==='end'&&compare(brushExtent,scaled,xScale)){setBrushExtent(scaled,mode);}setLocalBrushExtent(scaled);},[xScale,brushExtent,setBrushExtent]);// keep local and external brush extent in sync\n// i.e. snap to ticks on bruhs end\nuseEffect(function(){setLocalBrushExtent(brushExtent);},[brushExtent]);// initialize the brush\nuseEffect(function(){if(!brushRef.current)return;brushBehavior.current=brushX().extent([[Math.max(0+BRUSH_EXTENT_MARGIN_PX,xScale(0)),0],[innerWidth-BRUSH_EXTENT_MARGIN_PX,innerHeight]]).handleSize(30).filter(function(){return interactive;}).on('brush end',brushed);brushBehavior.current(select(brushRef.current));if(previousBrushExtent&&compare(brushExtent,previousBrushExtent,xScale)){select(brushRef.current).transition().call(brushBehavior.current.move,brushExtent.map(xScale));}// brush linear gradient\nselect(brushRef.current).selectAll('.selection').attr('stroke','none').attr('fill-opacity','0.1').attr('fill',\"url(#\".concat(id,\"-gradient-selection)\"));},[brushExtent,brushed,id,innerHeight,innerWidth,interactive,previousBrushExtent,xScale]);// respond to xScale changes only\nuseEffect(function(){if(!brushRef.current||!brushBehavior.current)return;brushBehavior.current.move(select(brushRef.current),brushExtent.map(xScale));},[brushExtent,xScale]);// show labels when local brush changes\nuseEffect(function(){setShowLabels(true);var timeout=setTimeout(function(){return setShowLabels(false);},1500);return function(){return clearTimeout(timeout);};},[localBrushExtent]);// variables to help render the SVGs\nvar flipWestHandle=localBrushExtent&&xScale(localBrushExtent[0])>FLIP_HANDLE_THRESHOLD_PX;var flipEastHandle=localBrushExtent&&xScale(localBrushExtent[1])>innerWidth-FLIP_HANDLE_THRESHOLD_PX;var showWestArrow=localBrushExtent&&(xScale(localBrushExtent[0])<0||xScale(localBrushExtent[1])<0);var showEastArrow=localBrushExtent&&(xScale(localBrushExtent[0])>innerWidth||xScale(localBrushExtent[1])>innerWidth);var westHandleInView=localBrushExtent&&xScale(localBrushExtent[0])>=0&&xScale(localBrushExtent[0])<=innerWidth;var eastHandleInView=localBrushExtent&&xScale(localBrushExtent[1])>=0&&xScale(localBrushExtent[1])<=innerWidth;return useMemo(function(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"defs\",{children:[/*#__PURE__*/_jsxs(\"linearGradient\",{id:\"\".concat(id,\"-gradient-selection\"),x1:\"0%\",y1:\"100%\",x2:\"100%\",y2:\"100%\",children:[/*#__PURE__*/_jsx(\"stop\",{stopColor:westHandleColor}),/*#__PURE__*/_jsx(\"stop\",{stopColor:eastHandleColor,offset:\"1\"})]}),/*#__PURE__*/_jsx(\"clipPath\",{id:\"\".concat(id,\"-brush-clip\"),children:/*#__PURE__*/_jsx(\"rect\",{x:\"0\",y:\"0\",width:innerWidth,height:innerHeight})})]}),/*#__PURE__*/_jsx(\"g\",{ref:brushRef,clipPath:\"url(#\".concat(id,\"-brush-clip)\"),onMouseEnter:function onMouseEnter(){return setHovering(true);},onMouseLeave:function onMouseLeave(){return setHovering(false);}}),localBrushExtent&&/*#__PURE__*/_jsxs(_Fragment,{children:[westHandleInView?/*#__PURE__*/_jsxs(\"g\",{transform:\"translate(\".concat(Math.max(0,xScale(localBrushExtent[0])),\", 0), scale(\").concat(flipWestHandle?'-1':'1',\", 1)\"),children:[/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(Handle,{color:westHandleColor,d:brushHandlePath(innerHeight)}),/*#__PURE__*/_jsx(HandleAccent,{d:brushHandleAccentPath()})]}),/*#__PURE__*/_jsxs(LabelGroup,{transform:\"translate(50,0), scale(\".concat(flipWestHandle?'1':'-1',\", 1)\"),visible:showLabels||hovering,children:[/*#__PURE__*/_jsx(TooltipBackground,{y:\"0\",x:\"-30\",height:\"30\",width:\"60\",rx:\"8\"}),/*#__PURE__*/_jsx(Tooltip,{transform:\"scale(-1, 1)\",y:\"15\",dominantBaseline:\"middle\",children:brushLabelValue('w',localBrushExtent[0])})]})]}):null,eastHandleInView?/*#__PURE__*/_jsxs(\"g\",{transform:\"translate(\".concat(xScale(localBrushExtent[1]),\", 0), scale(\").concat(flipEastHandle?'-1':'1',\", 1)\"),children:[/*#__PURE__*/_jsxs(\"g\",{children:[/*#__PURE__*/_jsx(Handle,{color:eastHandleColor,d:brushHandlePath(innerHeight)}),/*#__PURE__*/_jsx(HandleAccent,{d:brushHandleAccentPath()})]}),/*#__PURE__*/_jsxs(LabelGroup,{transform:\"translate(50,0), scale(\".concat(flipEastHandle?'-1':'1',\", 1)\"),visible:showLabels||hovering,children:[/*#__PURE__*/_jsx(TooltipBackground,{y:\"0\",x:\"-30\",height:\"30\",width:\"60\",rx:\"8\"}),/*#__PURE__*/_jsx(Tooltip,{y:\"15\",dominantBaseline:\"middle\",children:brushLabelValue('e',localBrushExtent[1])})]})]}):null,showWestArrow&&/*#__PURE__*/_jsx(OffScreenHandle,{color:westHandleColor}),showEastArrow&&/*#__PURE__*/_jsx(\"g\",{transform:\"translate(\".concat(innerWidth,\", 0) scale(-1, 1)\"),children:/*#__PURE__*/_jsx(OffScreenHandle,{color:eastHandleColor})})]})]});},[brushLabelValue,eastHandleColor,eastHandleInView,flipEastHandle,flipWestHandle,hovering,id,innerHeight,innerWidth,localBrushExtent,showEastArrow,showLabels,showWestArrow,westHandleColor,westHandleInView,xScale]);};","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/components/LiquidityChartRangeInput/Brush.tsx"],"names":["React","useCallback","useEffect","useMemo","useRef","useState","brushX","select","brushHandleAccentPath","brushHandlePath","OffScreenHandle","usePrevious","Handle","styled","path","color","HandleAccent","theme","white","LabelGroup","g","visible","TooltipBackground","rect","bg2","Tooltip","text","text1","FLIP_HANDLE_THRESHOLD_PX","BRUSH_EXTENT_MARGIN_PX","compare","a1","a2","xScale","Brush","id","interactive","brushLabelValue","brushExtent","setBrushExtent","innerWidth","innerHeight","westHandleColor","eastHandleColor","brushRef","brushBehavior","localBrushExtent","setLocalBrushExtent","showLabels","setShowLabels","hovering","setHovering","previousBrushExtent","brushed","event","type","selection","mode","scaled","map","invert","current","extent","Math","max","handleSize","filter","on","transition","call","move","selectAll","attr","timeout","setTimeout","clearTimeout","flipWestHandle","flipEastHandle","showWestArrow","showEastArrow","westHandleInView","eastHandleInView"],"mappings":"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","sourcesContent":["import React, { useCallback, useEffect, useMemo, useRef, useState } from 'react'\nimport { BrushBehavior, brushX, D3BrushEvent, ScaleLinear, select } from 'd3'\nimport styled from 'styled-components/macro'\nimport { brushHandleAccentPath, brushHandlePath, OffScreenHandle } from 'components/LiquidityChartRangeInput/svg'\nimport usePrevious from 'hooks/usePrevious'\n\nconst Handle = styled.path<{ color: string }>`\n  cursor: ew-resize;\n  pointer-events: none;\n\n  stroke-width: 3;\n  stroke: ${({ color }) => color};\n  fill: ${({ color }) => color};\n`\n\nconst HandleAccent = styled.path`\n  cursor: ew-resize;\n  pointer-events: none;\n\n  stroke-width: 1.5;\n  stroke: ${({ theme }) => theme.white};\n  opacity: 0.6;\n`\n\nconst LabelGroup = styled.g<{ visible: boolean }>`\n  opacity: ${({ visible }) => (visible ? '1' : '0')};\n  transition: opacity 300ms;\n`\n\nconst TooltipBackground = styled.rect`\n  fill: ${({ theme }) => theme.bg2};\n`\n\nconst Tooltip = styled.text`\n  text-anchor: middle;\n  font-size: 13px;\n  fill: ${({ theme }) => theme.text1};\n`\n\n// flips the handles draggers when close to the container edges\nconst FLIP_HANDLE_THRESHOLD_PX = 20\n\n// margin to prevent tick snapping from putting the brush off screen\nconst BRUSH_EXTENT_MARGIN_PX = 2\n\nconst compare = (a1: [number, number], a2: [number, number], xScale: ScaleLinear<number, number>): boolean =>\n  xScale(a1[0]) !== xScale(a2[0]) || xScale(a1[1]) !== xScale(a2[1])\n\nexport const Brush = ({\n  id,\n  xScale,\n  interactive,\n  brushLabelValue,\n  brushExtent,\n  setBrushExtent,\n  innerWidth,\n  innerHeight,\n  westHandleColor,\n  eastHandleColor,\n}: {\n  id: string\n  xScale: ScaleLinear<number, number>\n  interactive: boolean\n  brushLabelValue: (d: 'w' | 'e', x: number) => string\n  brushExtent: [number, number]\n  setBrushExtent: (extent: [number, number], mode: string | undefined) => void\n  innerWidth: number\n  innerHeight: number\n  westHandleColor: string\n  eastHandleColor: string\n}) => {\n  const brushRef = useRef<SVGGElement | null>(null)\n  const brushBehavior = useRef<BrushBehavior<SVGGElement> | null>(null)\n\n  // only used to drag the handles on brush for performance\n  const [localBrushExtent, setLocalBrushExtent] = useState<[number, number] | null>(brushExtent)\n  const [showLabels, setShowLabels] = useState(false)\n  const [hovering, setHovering] = useState(false)\n\n  const previousBrushExtent = usePrevious(brushExtent)\n\n  const brushed = useCallback(\n    (event: D3BrushEvent<unknown>) => {\n      const { type, selection, mode } = event\n\n      if (!selection) {\n        setLocalBrushExtent(null)\n        return\n      }\n\n      const scaled = (selection as [number, number]).map(xScale.invert) as [number, number]\n\n      // avoid infinite render loop by checking for change\n      if (type === 'end' && compare(brushExtent, scaled, xScale)) {\n        setBrushExtent(scaled, mode)\n      }\n\n      setLocalBrushExtent(scaled)\n    },\n    [xScale, brushExtent, setBrushExtent]\n  )\n\n  // keep local and external brush extent in sync\n  // i.e. snap to ticks on bruhs end\n  useEffect(() => {\n    setLocalBrushExtent(brushExtent)\n  }, [brushExtent])\n\n  // initialize the brush\n  useEffect(() => {\n    if (!brushRef.current) return\n\n    brushBehavior.current = brushX<SVGGElement>()\n      .extent([\n        [Math.max(0 + BRUSH_EXTENT_MARGIN_PX, xScale(0)), 0],\n        [innerWidth - BRUSH_EXTENT_MARGIN_PX, innerHeight],\n      ])\n      .handleSize(30)\n      .filter(() => interactive)\n      .on('brush end', brushed)\n\n    brushBehavior.current(select(brushRef.current))\n\n    if (previousBrushExtent && compare(brushExtent, previousBrushExtent, xScale)) {\n      select(brushRef.current)\n        .transition()\n        .call(brushBehavior.current.move as any, brushExtent.map(xScale))\n    }\n\n    // brush linear gradient\n    select(brushRef.current)\n      .selectAll('.selection')\n      .attr('stroke', 'none')\n      .attr('fill-opacity', '0.1')\n      .attr('fill', `url(#${id}-gradient-selection)`)\n  }, [brushExtent, brushed, id, innerHeight, innerWidth, interactive, previousBrushExtent, xScale])\n\n  // respond to xScale changes only\n  useEffect(() => {\n    if (!brushRef.current || !brushBehavior.current) return\n\n    brushBehavior.current.move(select(brushRef.current) as any, brushExtent.map(xScale) as any)\n  }, [brushExtent, xScale])\n\n  // show labels when local brush changes\n  useEffect(() => {\n    setShowLabels(true)\n    const timeout = setTimeout(() => setShowLabels(false), 1500)\n    return () => clearTimeout(timeout)\n  }, [localBrushExtent])\n\n  // variables to help render the SVGs\n  const flipWestHandle = localBrushExtent && xScale(localBrushExtent[0]) > FLIP_HANDLE_THRESHOLD_PX\n  const flipEastHandle = localBrushExtent && xScale(localBrushExtent[1]) > innerWidth - FLIP_HANDLE_THRESHOLD_PX\n\n  const showWestArrow = localBrushExtent && (xScale(localBrushExtent[0]) < 0 || xScale(localBrushExtent[1]) < 0)\n  const showEastArrow =\n    localBrushExtent && (xScale(localBrushExtent[0]) > innerWidth || xScale(localBrushExtent[1]) > innerWidth)\n\n  const westHandleInView =\n    localBrushExtent && xScale(localBrushExtent[0]) >= 0 && xScale(localBrushExtent[0]) <= innerWidth\n  const eastHandleInView =\n    localBrushExtent && xScale(localBrushExtent[1]) >= 0 && xScale(localBrushExtent[1]) <= innerWidth\n\n  return useMemo(\n    () => (\n      <>\n        <defs>\n          <linearGradient id={`${id}-gradient-selection`} x1=\"0%\" y1=\"100%\" x2=\"100%\" y2=\"100%\">\n            <stop stopColor={westHandleColor} />\n            <stop stopColor={eastHandleColor} offset=\"1\" />\n          </linearGradient>\n\n          {/* clips at exactly the svg area */}\n          <clipPath id={`${id}-brush-clip`}>\n            <rect x=\"0\" y=\"0\" width={innerWidth} height={innerHeight} />\n          </clipPath>\n        </defs>\n\n        {/* will host the d3 brush */}\n        <g\n          ref={brushRef}\n          clipPath={`url(#${id}-brush-clip)`}\n          onMouseEnter={() => setHovering(true)}\n          onMouseLeave={() => setHovering(false)}\n        />\n\n        {/* custom brush handles */}\n        {localBrushExtent && (\n          <>\n            {/* west handle */}\n            {westHandleInView ? (\n              <g\n                transform={`translate(${Math.max(0, xScale(localBrushExtent[0]))}, 0), scale(${\n                  flipWestHandle ? '-1' : '1'\n                }, 1)`}\n              >\n                <g>\n                  <Handle color={westHandleColor} d={brushHandlePath(innerHeight)} />\n                  <HandleAccent d={brushHandleAccentPath()} />\n                </g>\n\n                <LabelGroup\n                  transform={`translate(50,0), scale(${flipWestHandle ? '1' : '-1'}, 1)`}\n                  visible={showLabels || hovering}\n                >\n                  <TooltipBackground y=\"0\" x=\"-30\" height=\"30\" width=\"60\" rx=\"8\" />\n                  <Tooltip transform={`scale(-1, 1)`} y=\"15\" dominantBaseline=\"middle\">\n                    {brushLabelValue('w', localBrushExtent[0])}\n                  </Tooltip>\n                </LabelGroup>\n              </g>\n            ) : null}\n\n            {/* east handle */}\n            {eastHandleInView ? (\n              <g transform={`translate(${xScale(localBrushExtent[1])}, 0), scale(${flipEastHandle ? '-1' : '1'}, 1)`}>\n                <g>\n                  <Handle color={eastHandleColor} d={brushHandlePath(innerHeight)} />\n                  <HandleAccent d={brushHandleAccentPath()} />\n                </g>\n\n                <LabelGroup\n                  transform={`translate(50,0), scale(${flipEastHandle ? '-1' : '1'}, 1)`}\n                  visible={showLabels || hovering}\n                >\n                  <TooltipBackground y=\"0\" x=\"-30\" height=\"30\" width=\"60\" rx=\"8\" />\n                  <Tooltip y=\"15\" dominantBaseline=\"middle\">\n                    {brushLabelValue('e', localBrushExtent[1])}\n                  </Tooltip>\n                </LabelGroup>\n              </g>\n            ) : null}\n\n            {showWestArrow && <OffScreenHandle color={westHandleColor} />}\n\n            {showEastArrow && (\n              <g transform={`translate(${innerWidth}, 0) scale(-1, 1)`}>\n                <OffScreenHandle color={eastHandleColor} />\n              </g>\n            )}\n          </>\n        )}\n      </>\n    ),\n    [\n      brushLabelValue,\n      eastHandleColor,\n      eastHandleInView,\n      flipEastHandle,\n      flipWestHandle,\n      hovering,\n      id,\n      innerHeight,\n      innerWidth,\n      localBrushExtent,\n      showEastArrow,\n      showLabels,\n      showWestArrow,\n      westHandleColor,\n      westHandleInView,\n      xScale,\n    ]\n  )\n}\n"]},"metadata":{},"sourceType":"module"}