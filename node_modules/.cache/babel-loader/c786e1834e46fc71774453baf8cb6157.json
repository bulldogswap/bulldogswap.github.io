{"ast":null,"code":"import _defineProperty from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{FeeAmount}from'@uniswap/v3-sdk';import{useFeeTierDistributionQuery}from'state/data/enhanced';import{skipToken}from'@reduxjs/toolkit/query/react';import{reduce}from'lodash';import{useBlockNumber}from'state/application/hooks';import ReactGA from'react-ga';import{useMemo}from'react';import{PoolState,usePool}from'./usePools';// maximum number of blocks past which we consider the data stale\nvar MAX_DATA_BLOCK_AGE=10;export function useFeeTierDistribution(currencyA,currencyB){var _usePoolTVL=usePoolTVL(currencyA===null||currencyA===void 0?void 0:currencyA.wrapped,currencyB===null||currencyB===void 0?void 0:currencyB.wrapped),isFetching=_usePoolTVL.isFetching,isLoading=_usePoolTVL.isLoading,isUninitialized=_usePoolTVL.isUninitialized,isError=_usePoolTVL.isError,distributions=_usePoolTVL.distributions;// fetch all pool states to determine pool state\nvar _usePool=usePool(currencyA,currencyB,FeeAmount.LOW),_usePool2=_slicedToArray(_usePool,1),poolStateLow=_usePool2[0];var _usePool3=usePool(currencyA,currencyB,FeeAmount.MEDIUM),_usePool4=_slicedToArray(_usePool3,1),poolStateMedium=_usePool4[0];var _usePool5=usePool(currencyA,currencyB,FeeAmount.HIGH),_usePool6=_slicedToArray(_usePool5,1),poolStateHigh=_usePool6[0];return useMemo(function(){var _distributions$FeeAmo,_distributions$FeeAmo2,_distributions$FeeAmo3,_ref;if(isLoading||isFetching||isUninitialized||isError||!distributions){return{isLoading:isLoading||isFetching||!isUninitialized,isError:isError,distributions:distributions};}var largestUsageFeeTier=Object.keys(distributions).map(function(d){return Number(d);}).filter(function(d){return distributions[d]!==0&&distributions[d]!==undefined;}).reduce(function(a,b){var _distributions$a,_distributions$b;return((_distributions$a=distributions[a])!==null&&_distributions$a!==void 0?_distributions$a:0)>((_distributions$b=distributions[b])!==null&&_distributions$b!==void 0?_distributions$b:0)?a:b;},-1);var percentages=!isLoading&&!isError&&distributions&&poolStateLow!==PoolState.LOADING&&poolStateMedium!==PoolState.LOADING&&poolStateHigh!==PoolState.LOADING?(_ref={},_defineProperty(_ref,FeeAmount.LOW,poolStateLow===PoolState.EXISTS?((_distributions$FeeAmo=distributions[FeeAmount.LOW])!==null&&_distributions$FeeAmo!==void 0?_distributions$FeeAmo:0)*100:undefined),_defineProperty(_ref,FeeAmount.MEDIUM,poolStateMedium===PoolState.EXISTS?((_distributions$FeeAmo2=distributions[FeeAmount.MEDIUM])!==null&&_distributions$FeeAmo2!==void 0?_distributions$FeeAmo2:0)*100:undefined),_defineProperty(_ref,FeeAmount.HIGH,poolStateHigh===PoolState.EXISTS?((_distributions$FeeAmo3=distributions[FeeAmount.HIGH])!==null&&_distributions$FeeAmo3!==void 0?_distributions$FeeAmo3:0)*100:undefined),_ref):undefined;return{isLoading:isLoading,isError:isError,distributions:percentages,largestUsageFeeTier:largestUsageFeeTier===-1?undefined:largestUsageFeeTier};},[isLoading,isFetching,isUninitialized,isError,distributions,poolStateLow,poolStateMedium,poolStateHigh]);}function usePoolTVL(token0,token1){var _ref3;var latestBlock=useBlockNumber();var _useFeeTierDistributi=useFeeTierDistributionQuery(token0&&token1?{token0:token0.address.toLowerCase(),token1:token1.address.toLowerCase()}:skipToken,{pollingInterval:120000}),isLoading=_useFeeTierDistributi.isLoading,isFetching=_useFeeTierDistributi.isFetching,isUninitialized=_useFeeTierDistributi.isUninitialized,isError=_useFeeTierDistributi.isError,data=_useFeeTierDistributi.data;var _ref2=(_ref3=data)!==null&&_ref3!==void 0?_ref3:{},asToken0=_ref2.asToken0,asToken1=_ref2.asToken1,_meta=_ref2._meta;return useMemo(function(){var _meta$block$number,_meta$block,_all$reduce,_distributions;if(!latestBlock||!_meta||!asToken0||!asToken1){return{isLoading:isLoading,isFetching:isFetching,isUninitialized:isUninitialized,isError:isError};}if(latestBlock-((_meta$block$number=_meta===null||_meta===void 0?void 0:(_meta$block=_meta.block)===null||_meta$block===void 0?void 0:_meta$block.number)!==null&&_meta$block$number!==void 0?_meta$block$number:0)>MAX_DATA_BLOCK_AGE){ReactGA.exception({description:\"Graph stale (latest block: \".concat(latestBlock,\")\")});return{isLoading:isLoading,isFetching:isFetching,isUninitialized:isUninitialized,isError:isError};}var all=asToken0.concat(asToken1);// sum tvl for token0 and token1 by fee tier\nvar tvlByFeeTer=all.reduce(function(acc,value){var _acc$value$feeTier$,_acc$value$feeTier$2;acc[value.feeTier][0]=((_acc$value$feeTier$=acc[value.feeTier][0])!==null&&_acc$value$feeTier$!==void 0?_acc$value$feeTier$:0)+Number(value.totalValueLockedToken0);acc[value.feeTier][1]=((_acc$value$feeTier$2=acc[value.feeTier][1])!==null&&_acc$value$feeTier$2!==void 0?_acc$value$feeTier$2:0)+Number(value.totalValueLockedToken1);return acc;},(_all$reduce={},_defineProperty(_all$reduce,FeeAmount.LOW,[undefined,undefined]),_defineProperty(_all$reduce,FeeAmount.MEDIUM,[undefined,undefined]),_defineProperty(_all$reduce,FeeAmount.HIGH,[undefined,undefined]),_all$reduce));// sum total tvl for token0 and token1\nvar _reduce=reduce(tvlByFeeTer,function(acc,value){var _value$,_value$2;acc[0]+=(_value$=value[0])!==null&&_value$!==void 0?_value$:0;acc[1]+=(_value$2=value[1])!==null&&_value$2!==void 0?_value$2:0;return acc;},[0,0]),_reduce2=_slicedToArray(_reduce,2),sumToken0Tvl=_reduce2[0],sumToken1Tvl=_reduce2[1];// returns undefined if both tvl0 and tvl1 are undefined (pool not created)\nvar mean=function mean(tvl0,sumTvl0,tvl1,sumTvl1){return tvl0===undefined&&tvl1===undefined?undefined:((tvl0!==null&&tvl0!==void 0?tvl0:0)+(tvl1!==null&&tvl1!==void 0?tvl1:0))/(sumTvl0+sumTvl1)||0;};return{isLoading:isLoading,isFetching:isFetching,isUninitialized:isUninitialized,isError:isError,distributions:(_distributions={},_defineProperty(_distributions,FeeAmount.LOW,mean(tvlByFeeTer[FeeAmount.LOW][0],sumToken0Tvl,tvlByFeeTer[FeeAmount.LOW][1],sumToken1Tvl)),_defineProperty(_distributions,FeeAmount.MEDIUM,mean(tvlByFeeTer[FeeAmount.MEDIUM][0],sumToken0Tvl,tvlByFeeTer[FeeAmount.MEDIUM][1],sumToken1Tvl)),_defineProperty(_distributions,FeeAmount.HIGH,mean(tvlByFeeTer[FeeAmount.HIGH][0],sumToken0Tvl,tvlByFeeTer[FeeAmount.HIGH][1],sumToken1Tvl)),_distributions)};},[_meta,asToken0,asToken1,isLoading,isError,isFetching,isUninitialized,latestBlock]);}","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/hooks/useFeeTierDistribution.ts"],"names":["FeeAmount","useFeeTierDistributionQuery","skipToken","reduce","useBlockNumber","ReactGA","useMemo","PoolState","usePool","MAX_DATA_BLOCK_AGE","useFeeTierDistribution","currencyA","currencyB","usePoolTVL","wrapped","isFetching","isLoading","isUninitialized","isError","distributions","LOW","poolStateLow","MEDIUM","poolStateMedium","HIGH","poolStateHigh","largestUsageFeeTier","Object","keys","map","d","Number","filter","undefined","a","b","percentages","LOADING","EXISTS","token0","token1","latestBlock","address","toLowerCase","pollingInterval","data","asToken0","asToken1","_meta","block","number","exception","description","all","concat","tvlByFeeTer","acc","value","feeTier","totalValueLockedToken0","totalValueLockedToken1","sumToken0Tvl","sumToken1Tvl","mean","tvl0","sumTvl0","tvl1","sumTvl1"],"mappings":"kXAAA,OAASA,SAAT,KAA0B,iBAA1B,CAEA,OAASC,2BAAT,KAA4C,qBAA5C,CACA,OAASC,SAAT,KAA0B,8BAA1B,CACA,OAASC,MAAT,KAAuB,QAAvB,CACA,OAASC,cAAT,KAA+B,yBAA/B,CACA,MAAOC,CAAAA,OAAP,KAAoB,UAApB,CACA,OAASC,OAAT,KAAwB,OAAxB,CAGA,OAASC,SAAT,CAAoBC,OAApB,KAAmC,YAAnC,CAEA;AACA,GAAMC,CAAAA,kBAAkB,CAAG,EAA3B,CAeA,MAAO,SAASC,CAAAA,sBAAT,CACLC,SADK,CAELC,SAFK,CAGgB,CACrB,gBAA2EC,UAAU,CACnFF,SADmF,SACnFA,SADmF,iBACnFA,SAAS,CAAEG,OADwE,CAEnFF,SAFmF,SAEnFA,SAFmF,iBAEnFA,SAAS,CAAEE,OAFwE,CAArF,CAAQC,UAAR,aAAQA,UAAR,CAAoBC,SAApB,aAAoBA,SAApB,CAA+BC,eAA/B,aAA+BA,eAA/B,CAAgDC,OAAhD,aAAgDA,OAAhD,CAAyDC,aAAzD,aAAyDA,aAAzD,CAKA;AACA,aAAuBX,OAAO,CAACG,SAAD,CAAYC,SAAZ,CAAuBZ,SAAS,CAACoB,GAAjC,CAA9B,sCAAOC,YAAP,cACA,cAA0Bb,OAAO,CAACG,SAAD,CAAYC,SAAZ,CAAuBZ,SAAS,CAACsB,MAAjC,CAAjC,uCAAOC,eAAP,cACA,cAAwBf,OAAO,CAACG,SAAD,CAAYC,SAAZ,CAAuBZ,SAAS,CAACwB,IAAjC,CAA/B,uCAAOC,aAAP,cAEA,MAAOnB,CAAAA,OAAO,CAAC,UAAM,8EACnB,GAAIU,SAAS,EAAID,UAAb,EAA2BE,eAA3B,EAA8CC,OAA9C,EAAyD,CAACC,aAA9D,CAA6E,CAC3E,MAAO,CACLH,SAAS,CAAEA,SAAS,EAAID,UAAb,EAA2B,CAACE,eADlC,CAELC,OAAO,CAAPA,OAFK,CAGLC,aAAa,CAAbA,aAHK,CAAP,CAKD,CAED,GAAMO,CAAAA,mBAAmB,CAAGC,MAAM,CAACC,IAAP,CAAYT,aAAZ,EACzBU,GADyB,CACrB,SAACC,CAAD,QAAOC,CAAAA,MAAM,CAACD,CAAD,CAAb,EADqB,EAEzBE,MAFyB,CAElB,SAACF,CAAD,QAAkBX,CAAAA,aAAa,CAACW,CAAD,CAAb,GAAqB,CAArB,EAA0BX,aAAa,CAACW,CAAD,CAAb,GAAqBG,SAAjE,EAFkB,EAGzB9B,MAHyB,CAGlB,SAAC+B,CAAD,CAAeC,CAAf,8CAAiC,mBAAChB,aAAa,CAACe,CAAD,CAAd,qDAAqB,CAArB,qBAA2Bf,aAAa,CAACgB,CAAD,CAAxC,qDAA+C,CAA/C,EAAoDD,CAApD,CAAwDC,CAAzF,EAHkB,CAG2E,CAAC,CAH5E,CAA5B,CAKA,GAAMC,CAAAA,WAAW,CACf,CAACpB,SAAD,EACA,CAACE,OADD,EAEAC,aAFA,EAGAE,YAAY,GAAKd,SAAS,CAAC8B,OAH3B,EAIAd,eAAe,GAAKhB,SAAS,CAAC8B,OAJ9B,EAKAZ,aAAa,GAAKlB,SAAS,CAAC8B,OAL5B,+BAOOrC,SAAS,CAACoB,GAPjB,CAOuBC,YAAY,GAAKd,SAAS,CAAC+B,MAA3B,CAAoC,wBAACnB,aAAa,CAACnB,SAAS,CAACoB,GAAX,CAAd,+DAAiC,CAAjC,EAAsC,GAA1E,CAAgFa,SAPvG,uBAQOjC,SAAS,CAACsB,MARjB,CASQC,eAAe,GAAKhB,SAAS,CAAC+B,MAA9B,CAAuC,yBAACnB,aAAa,CAACnB,SAAS,CAACsB,MAAX,CAAd,iEAAoC,CAApC,EAAyC,GAAhF,CAAsFW,SAT9F,uBAUOjC,SAAS,CAACwB,IAVjB,CAWQC,aAAa,GAAKlB,SAAS,CAAC+B,MAA5B,CAAqC,yBAACnB,aAAa,CAACnB,SAAS,CAACwB,IAAX,CAAd,iEAAkC,CAAlC,EAAuC,GAA5E,CAAkFS,SAX1F,QAaIA,SAdN,CAgBA,MAAO,CACLjB,SAAS,CAATA,SADK,CAELE,OAAO,CAAPA,OAFK,CAGLC,aAAa,CAAEiB,WAHV,CAILV,mBAAmB,CAAEA,mBAAmB,GAAK,CAAC,CAAzB,CAA6BO,SAA7B,CAAyCP,mBAJzD,CAAP,CAMD,CApCa,CAoCX,CAACV,SAAD,CAAYD,UAAZ,CAAwBE,eAAxB,CAAyCC,OAAzC,CAAkDC,aAAlD,CAAiEE,YAAjE,CAA+EE,eAA/E,CAAgGE,aAAhG,CApCW,CAAd,CAqCD,CAED,QAASZ,CAAAA,UAAT,CAAoB0B,MAApB,CAA+CC,MAA/C,CAA0E,WACxE,GAAMC,CAAAA,WAAW,CAAGrC,cAAc,EAAlC,CAEA,0BAAkEH,2BAA2B,CAC3FsC,MAAM,EAAIC,MAAV,CAAmB,CAAED,MAAM,CAAEA,MAAM,CAACG,OAAP,CAAeC,WAAf,EAAV,CAAwCH,MAAM,CAAEA,MAAM,CAACE,OAAP,CAAeC,WAAf,EAAhD,CAAnB,CAAoGzC,SADT,CAE3F,CACE0C,eAAe,OADjB,CAF2F,CAA7F,CAAQ5B,SAAR,uBAAQA,SAAR,CAAmBD,UAAnB,uBAAmBA,UAAnB,CAA+BE,eAA/B,uBAA+BA,eAA/B,CAAgDC,OAAhD,uBAAgDA,OAAhD,CAAyD2B,IAAzD,uBAAyDA,IAAzD,CAOA,iBAAuCA,IAAvC,+BAA4E,EAA5E,CAAQC,QAAR,OAAQA,QAAR,CAAkBC,QAAlB,OAAkBA,QAAlB,CAA4BC,KAA5B,OAA4BA,KAA5B,CAEA,MAAO1C,CAAAA,OAAO,CAAC,UAAM,+DACnB,GAAI,CAACmC,WAAD,EAAgB,CAACO,KAAjB,EAA0B,CAACF,QAA3B,EAAuC,CAACC,QAA5C,CAAsD,CACpD,MAAO,CACL/B,SAAS,CAATA,SADK,CAELD,UAAU,CAAVA,UAFK,CAGLE,eAAe,CAAfA,eAHK,CAILC,OAAO,CAAPA,OAJK,CAAP,CAMD,CAED,GAAIuB,WAAW,sBAAIO,KAAJ,SAAIA,KAAJ,8BAAIA,KAAK,CAAEC,KAAX,sCAAI,YAAcC,MAAlB,yDAA4B,CAA5B,CAAX,CAA4CzC,kBAAhD,CAAoE,CAClEJ,OAAO,CAAC8C,SAAR,CAAkB,CAChBC,WAAW,sCAAgCX,WAAhC,KADK,CAAlB,EAIA,MAAO,CACLzB,SAAS,CAATA,SADK,CAELD,UAAU,CAAVA,UAFK,CAGLE,eAAe,CAAfA,eAHK,CAILC,OAAO,CAAPA,OAJK,CAAP,CAMD,CAED,GAAMmC,CAAAA,GAAG,CAAGP,QAAQ,CAACQ,MAAT,CAAgBP,QAAhB,CAAZ,CAEA;AACA,GAAMQ,CAAAA,WAAW,CAAGF,GAAG,CAAClD,MAAJ,CAClB,SAACqD,GAAD,CAAMC,KAAN,CAAgB,8CACdD,GAAG,CAACC,KAAK,CAACC,OAAP,CAAH,CAAmB,CAAnB,EAAwB,sBAACF,GAAG,CAACC,KAAK,CAACC,OAAP,CAAH,CAAmB,CAAnB,CAAD,2DAA0B,CAA1B,EAA+B3B,MAAM,CAAC0B,KAAK,CAACE,sBAAP,CAA7D,CACAH,GAAG,CAACC,KAAK,CAACC,OAAP,CAAH,CAAmB,CAAnB,EAAwB,uBAACF,GAAG,CAACC,KAAK,CAACC,OAAP,CAAH,CAAmB,CAAnB,CAAD,6DAA0B,CAA1B,EAA+B3B,MAAM,CAAC0B,KAAK,CAACG,sBAAP,CAA7D,CACA,MAAOJ,CAAAA,GAAP,CACD,CALiB,6CAOfxD,SAAS,CAACoB,GAPK,CAOC,CAACa,SAAD,CAAYA,SAAZ,CAPD,8BAQfjC,SAAS,CAACsB,MARK,CAQI,CAACW,SAAD,CAAYA,SAAZ,CARJ,8BASfjC,SAAS,CAACwB,IATK,CASE,CAACS,SAAD,CAAYA,SAAZ,CATF,eAApB,CAaA;AACA,YAAqC9B,MAAM,CACzCoD,WADyC,CAEzC,SAACC,GAAD,CAAwBC,KAAxB,CAAkC,sBAChCD,GAAG,CAAC,CAAD,CAAH,WAAUC,KAAK,CAAC,CAAD,CAAf,mCAAsB,CAAtB,CACAD,GAAG,CAAC,CAAD,CAAH,YAAUC,KAAK,CAAC,CAAD,CAAf,qCAAsB,CAAtB,CACA,MAAOD,CAAAA,GAAP,CACD,CANwC,CAOzC,CAAC,CAAD,CAAI,CAAJ,CAPyC,CAA3C,oCAAOK,YAAP,aAAqBC,YAArB,aAUA;AACA,GAAMC,CAAAA,IAAI,CAAG,QAAPA,CAAAA,IAAO,CAACC,IAAD,CAA2BC,OAA3B,CAA4CC,IAA5C,CAAsEC,OAAtE,QACXH,CAAAA,IAAI,GAAK/B,SAAT,EAAsBiC,IAAI,GAAKjC,SAA/B,CAA2CA,SAA3C,CAAuD,CAAC,CAAC+B,IAAD,SAACA,IAAD,UAACA,IAAD,CAAS,CAAT,GAAeE,IAAf,SAAeA,IAAf,UAAeA,IAAf,CAAuB,CAAvB,CAAD,GAA+BD,OAAO,CAAGE,OAAzC,GAAqD,CADjG,EAAb,CAGA,MAAO,CACLnD,SAAS,CAATA,SADK,CAELD,UAAU,CAAVA,UAFK,CAGLE,eAAe,CAAfA,eAHK,CAILC,OAAO,CAAPA,OAJK,CAKLC,aAAa,mDACVnB,SAAS,CAACoB,GADA,CACM2C,IAAI,CAACR,WAAW,CAACvD,SAAS,CAACoB,GAAX,CAAX,CAA2B,CAA3B,CAAD,CAAgCyC,YAAhC,CAA8CN,WAAW,CAACvD,SAAS,CAACoB,GAAX,CAAX,CAA2B,CAA3B,CAA9C,CAA6E0C,YAA7E,CADV,iCAEV9D,SAAS,CAACsB,MAFA,CAESyC,IAAI,CACtBR,WAAW,CAACvD,SAAS,CAACsB,MAAX,CAAX,CAA8B,CAA9B,CADsB,CAEtBuC,YAFsB,CAGtBN,WAAW,CAACvD,SAAS,CAACsB,MAAX,CAAX,CAA8B,CAA9B,CAHsB,CAItBwC,YAJsB,CAFb,iCAQV9D,SAAS,CAACwB,IARA,CAQOuC,IAAI,CACpBR,WAAW,CAACvD,SAAS,CAACwB,IAAX,CAAX,CAA4B,CAA5B,CADoB,CAEpBqC,YAFoB,CAGpBN,WAAW,CAACvD,SAAS,CAACwB,IAAX,CAAX,CAA4B,CAA5B,CAHoB,CAIpBsC,YAJoB,CARX,iBALR,CAAP,CAqBD,CA3Ea,CA2EX,CAACd,KAAD,CAAQF,QAAR,CAAkBC,QAAlB,CAA4B/B,SAA5B,CAAuCE,OAAvC,CAAgDH,UAAhD,CAA4DE,eAA5D,CAA6EwB,WAA7E,CA3EW,CAAd,CA4ED","sourcesContent":["import { FeeAmount } from '@uniswap/v3-sdk'\nimport { Token, Currency } from '@uniswap/sdk-core'\nimport { useFeeTierDistributionQuery } from 'state/data/enhanced'\nimport { skipToken } from '@reduxjs/toolkit/query/react'\nimport { reduce } from 'lodash'\nimport { useBlockNumber } from 'state/application/hooks'\nimport ReactGA from 'react-ga'\nimport { useMemo } from 'react'\nimport { FeeTierDistributionQuery } from 'state/data/generated'\nimport ms from 'ms.macro'\nimport { PoolState, usePool } from './usePools'\n\n// maximum number of blocks past which we consider the data stale\nconst MAX_DATA_BLOCK_AGE = 10\n\ninterface FeeTierDistribution {\n  isLoading: boolean\n  isError: boolean\n  largestUsageFeeTier?: FeeAmount | undefined\n\n  // distributions as percentages of overall liquidity\n  distributions?: {\n    [FeeAmount.LOW]: number | undefined\n    [FeeAmount.MEDIUM]: number | undefined\n    [FeeAmount.HIGH]: number | undefined\n  }\n}\n\nexport function useFeeTierDistribution(\n  currencyA: Currency | undefined,\n  currencyB: Currency | undefined\n): FeeTierDistribution {\n  const { isFetching, isLoading, isUninitialized, isError, distributions } = usePoolTVL(\n    currencyA?.wrapped,\n    currencyB?.wrapped\n  )\n\n  // fetch all pool states to determine pool state\n  const [poolStateLow] = usePool(currencyA, currencyB, FeeAmount.LOW)\n  const [poolStateMedium] = usePool(currencyA, currencyB, FeeAmount.MEDIUM)\n  const [poolStateHigh] = usePool(currencyA, currencyB, FeeAmount.HIGH)\n\n  return useMemo(() => {\n    if (isLoading || isFetching || isUninitialized || isError || !distributions) {\n      return {\n        isLoading: isLoading || isFetching || !isUninitialized,\n        isError,\n        distributions,\n      }\n    }\n\n    const largestUsageFeeTier = Object.keys(distributions)\n      .map((d) => Number(d))\n      .filter((d: FeeAmount) => distributions[d] !== 0 && distributions[d] !== undefined)\n      .reduce((a: FeeAmount, b: FeeAmount) => ((distributions[a] ?? 0) > (distributions[b] ?? 0) ? a : b), -1)\n\n    const percentages =\n      !isLoading &&\n      !isError &&\n      distributions &&\n      poolStateLow !== PoolState.LOADING &&\n      poolStateMedium !== PoolState.LOADING &&\n      poolStateHigh !== PoolState.LOADING\n        ? {\n            [FeeAmount.LOW]: poolStateLow === PoolState.EXISTS ? (distributions[FeeAmount.LOW] ?? 0) * 100 : undefined,\n            [FeeAmount.MEDIUM]:\n              poolStateMedium === PoolState.EXISTS ? (distributions[FeeAmount.MEDIUM] ?? 0) * 100 : undefined,\n            [FeeAmount.HIGH]:\n              poolStateHigh === PoolState.EXISTS ? (distributions[FeeAmount.HIGH] ?? 0) * 100 : undefined,\n          }\n        : undefined\n\n    return {\n      isLoading,\n      isError,\n      distributions: percentages,\n      largestUsageFeeTier: largestUsageFeeTier === -1 ? undefined : largestUsageFeeTier,\n    }\n  }, [isLoading, isFetching, isUninitialized, isError, distributions, poolStateLow, poolStateMedium, poolStateHigh])\n}\n\nfunction usePoolTVL(token0: Token | undefined, token1: Token | undefined) {\n  const latestBlock = useBlockNumber()\n\n  const { isLoading, isFetching, isUninitialized, isError, data } = useFeeTierDistributionQuery(\n    token0 && token1 ? { token0: token0.address.toLowerCase(), token1: token1.address.toLowerCase() } : skipToken,\n    {\n      pollingInterval: ms`2m`,\n    }\n  )\n\n  const { asToken0, asToken1, _meta } = (data as FeeTierDistributionQuery) ?? {}\n\n  return useMemo(() => {\n    if (!latestBlock || !_meta || !asToken0 || !asToken1) {\n      return {\n        isLoading,\n        isFetching,\n        isUninitialized,\n        isError,\n      }\n    }\n\n    if (latestBlock - (_meta?.block?.number ?? 0) > MAX_DATA_BLOCK_AGE) {\n      ReactGA.exception({\n        description: `Graph stale (latest block: ${latestBlock})`,\n      })\n\n      return {\n        isLoading,\n        isFetching,\n        isUninitialized,\n        isError,\n      }\n    }\n\n    const all = asToken0.concat(asToken1)\n\n    // sum tvl for token0 and token1 by fee tier\n    const tvlByFeeTer = all.reduce<{ [feeAmount: number]: [number | undefined, number | undefined] }>(\n      (acc, value) => {\n        acc[value.feeTier][0] = (acc[value.feeTier][0] ?? 0) + Number(value.totalValueLockedToken0)\n        acc[value.feeTier][1] = (acc[value.feeTier][1] ?? 0) + Number(value.totalValueLockedToken1)\n        return acc\n      },\n      {\n        [FeeAmount.LOW]: [undefined, undefined],\n        [FeeAmount.MEDIUM]: [undefined, undefined],\n        [FeeAmount.HIGH]: [undefined, undefined],\n      }\n    )\n\n    // sum total tvl for token0 and token1\n    const [sumToken0Tvl, sumToken1Tvl] = reduce(\n      tvlByFeeTer,\n      (acc: [number, number], value) => {\n        acc[0] += value[0] ?? 0\n        acc[1] += value[1] ?? 0\n        return acc\n      },\n      [0, 0]\n    )\n\n    // returns undefined if both tvl0 and tvl1 are undefined (pool not created)\n    const mean = (tvl0: number | undefined, sumTvl0: number, tvl1: number | undefined, sumTvl1: number) =>\n      tvl0 === undefined && tvl1 === undefined ? undefined : ((tvl0 ?? 0) + (tvl1 ?? 0)) / (sumTvl0 + sumTvl1) || 0\n\n    return {\n      isLoading,\n      isFetching,\n      isUninitialized,\n      isError,\n      distributions: {\n        [FeeAmount.LOW]: mean(tvlByFeeTer[FeeAmount.LOW][0], sumToken0Tvl, tvlByFeeTer[FeeAmount.LOW][1], sumToken1Tvl),\n        [FeeAmount.MEDIUM]: mean(\n          tvlByFeeTer[FeeAmount.MEDIUM][0],\n          sumToken0Tvl,\n          tvlByFeeTer[FeeAmount.MEDIUM][1],\n          sumToken1Tvl\n        ),\n        [FeeAmount.HIGH]: mean(\n          tvlByFeeTer[FeeAmount.HIGH][0],\n          sumToken0Tvl,\n          tvlByFeeTer[FeeAmount.HIGH][1],\n          sumToken1Tvl\n        ),\n      },\n    }\n  }, [_meta, asToken0, asToken1, isLoading, isError, isFetching, isUninitialized, latestBlock])\n}\n"]},"metadata":{},"sourceType":"module"}