{"ast":null,"code":"import _regeneratorRuntime from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _defineProperty from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";var _,_2,_3,_PERMITTABLE_TOKENS;import JSBI from'jsbi';import{Trade as V2Trade}from'@uniswap/v2-sdk';import{Trade as V3Trade}from'@uniswap/v3-sdk';import{splitSignature}from'ethers/lib/utils';import{useMemo,useState}from'react';import{SWAP_ROUTER_ADDRESSES}from'../constants/addresses';import{DAI,UNI,USDC}from'../constants/tokens';import{useSingleCallResult}from'../state/multicall/hooks';import{useActiveWeb3React}from'./web3';import{useEIP2612Contract}from'./useContract';import useIsArgentWallet from'./useIsArgentWallet';import useTransactionDeadline from'./useTransactionDeadline';var PermitType;// 20 minutes to submit after signing\n(function(PermitType){PermitType[PermitType[\"AMOUNT\"]=1]=\"AMOUNT\";PermitType[PermitType[\"ALLOWED\"]=2]=\"ALLOWED\";})(PermitType||(PermitType={}));var PERMIT_VALIDITY_BUFFER=20*60;// todo: read this information from extensions on token lists or elsewhere (permit registry?)\nvar PERMITTABLE_TOKENS=(_PERMITTABLE_TOKENS={},_defineProperty(_PERMITTABLE_TOKENS,1,(_={},_defineProperty(_,USDC.address,{type:PermitType.AMOUNT,name:'USD Coin',version:'2'}),_defineProperty(_,DAI.address,{type:PermitType.ALLOWED,name:'Dai Stablecoin',version:'1'}),_defineProperty(_,UNI[1].address,{type:PermitType.AMOUNT,name:'Uniswap'}),_)),_defineProperty(_PERMITTABLE_TOKENS,4,(_2={},_defineProperty(_2,'0xc7AD46e0b8a400Bb3C915120d284AafbA8fc4735',{type:PermitType.ALLOWED,name:'Dai Stablecoin',version:'1'}),_defineProperty(_2,UNI[4].address,{type:PermitType.AMOUNT,name:'Uniswap'}),_2)),_defineProperty(_PERMITTABLE_TOKENS,3,(_3={},_defineProperty(_3,UNI[3].address,{type:PermitType.AMOUNT,name:'Uniswap'}),_defineProperty(_3,'0x07865c6E87B9F70255377e024ace6630C1Eaa37F',{type:PermitType.AMOUNT,name:'USD Coin',version:'2'}),_3)),_defineProperty(_PERMITTABLE_TOKENS,5,_defineProperty({},UNI[5].address,{type:PermitType.AMOUNT,name:'Uniswap'})),_defineProperty(_PERMITTABLE_TOKENS,42,_defineProperty({},UNI[42].address,{type:PermitType.AMOUNT,name:'Uniswap'})),_PERMITTABLE_TOKENS);export var UseERC20PermitState;(function(UseERC20PermitState){UseERC20PermitState[UseERC20PermitState[\"NOT_APPLICABLE\"]=0]=\"NOT_APPLICABLE\";UseERC20PermitState[UseERC20PermitState[\"LOADING\"]=1]=\"LOADING\";UseERC20PermitState[UseERC20PermitState[\"NOT_SIGNED\"]=2]=\"NOT_SIGNED\";UseERC20PermitState[UseERC20PermitState[\"SIGNED\"]=3]=\"SIGNED\";})(UseERC20PermitState||(UseERC20PermitState={}));var EIP712_DOMAIN_TYPE=[{name:'name',type:'string'},{name:'version',type:'string'},{name:'chainId',type:'uint256'},{name:'verifyingContract',type:'address'}];var EIP712_DOMAIN_TYPE_NO_VERSION=[{name:'name',type:'string'},{name:'chainId',type:'uint256'},{name:'verifyingContract',type:'address'}];var EIP2612_TYPE=[{name:'owner',type:'address'},{name:'spender',type:'address'},{name:'value',type:'uint256'},{name:'nonce',type:'uint256'},{name:'deadline',type:'uint256'}];var PERMIT_ALLOWED_TYPE=[{name:'holder',type:'address'},{name:'spender',type:'address'},{name:'nonce',type:'uint256'},{name:'expiry',type:'uint256'},{name:'allowed',type:'bool'}];function useERC20Permit(currencyAmount,spender,overridePermitInfo){var _currencyAmount$curre,_PERMITTABLE_TOKENS$c;var _useActiveWeb3React=useActiveWeb3React(),account=_useActiveWeb3React.account,chainId=_useActiveWeb3React.chainId,library=_useActiveWeb3React.library;var transactionDeadline=useTransactionDeadline();var tokenAddress=(currencyAmount===null||currencyAmount===void 0?void 0:(_currencyAmount$curre=currencyAmount.currency)===null||_currencyAmount$curre===void 0?void 0:_currencyAmount$curre.isToken)?currencyAmount.currency.address:undefined;var eip2612Contract=useEIP2612Contract(tokenAddress);var isArgentWallet=useIsArgentWallet();var nonceInputs=useMemo(function(){return[account!==null&&account!==void 0?account:undefined];},[account]);var tokenNonceState=useSingleCallResult(eip2612Contract,'nonces',nonceInputs);var permitInfo=overridePermitInfo!==null&&overridePermitInfo!==void 0?overridePermitInfo:chainId&&tokenAddress?(_PERMITTABLE_TOKENS$c=PERMITTABLE_TOKENS[chainId])===null||_PERMITTABLE_TOKENS$c===void 0?void 0:_PERMITTABLE_TOKENS$c[tokenAddress]:undefined;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),signatureData=_useState2[0],setSignatureData=_useState2[1];return useMemo(function(){var _tokenNonceState$resu,_tokenNonceState$resu2;if(isArgentWallet||!currencyAmount||!eip2612Contract||!account||!chainId||!transactionDeadline||!library||!tokenNonceState.valid||!tokenAddress||!spender||!permitInfo){return{state:UseERC20PermitState.NOT_APPLICABLE,signatureData:null,gatherPermitSignature:null};}var nonceNumber=(_tokenNonceState$resu=tokenNonceState.result)===null||_tokenNonceState$resu===void 0?void 0:(_tokenNonceState$resu2=_tokenNonceState$resu[0])===null||_tokenNonceState$resu2===void 0?void 0:_tokenNonceState$resu2.toNumber();if(tokenNonceState.loading||typeof nonceNumber!=='number'){return{state:UseERC20PermitState.LOADING,signatureData:null,gatherPermitSignature:null};}var isSignatureDataValid=signatureData&&signatureData.owner===account&&signatureData.deadline>=transactionDeadline.toNumber()&&signatureData.tokenAddress===tokenAddress&&signatureData.nonce===nonceNumber&&signatureData.spender===spender&&('allowed'in signatureData||JSBI.equal(JSBI.BigInt(signatureData.amount),currencyAmount.quotient));return{state:isSignatureDataValid?UseERC20PermitState.SIGNED:UseERC20PermitState.NOT_SIGNED,signatureData:isSignatureDataValid?signatureData:null,gatherPermitSignature:function(){var _gatherPermitSignature=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var allowed,signatureDeadline,value,message,domain,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:allowed=permitInfo.type===PermitType.ALLOWED;signatureDeadline=transactionDeadline.toNumber()+PERMIT_VALIDITY_BUFFER;value=currencyAmount.quotient.toString();message=allowed?{holder:account,spender:spender,allowed:allowed,nonce:nonceNumber,expiry:signatureDeadline}:{owner:account,spender:spender,value:value,nonce:nonceNumber,deadline:signatureDeadline};domain=permitInfo.version?{name:permitInfo.name,version:permitInfo.version,verifyingContract:tokenAddress,chainId:chainId}:{name:permitInfo.name,verifyingContract:tokenAddress,chainId:chainId};data=JSON.stringify({types:{EIP712Domain:permitInfo.version?EIP712_DOMAIN_TYPE:EIP712_DOMAIN_TYPE_NO_VERSION,Permit:allowed?PERMIT_ALLOWED_TYPE:EIP2612_TYPE},domain:domain,primaryType:'Permit',message:message});return _context.abrupt(\"return\",library.send('eth_signTypedData_v4',[account,data]).then(splitSignature).then(function(signature){setSignatureData(_objectSpread(_objectSpread({v:signature.v,r:signature.r,s:signature.s,deadline:signatureDeadline},allowed?{allowed:allowed}:{amount:value}),{},{nonce:nonceNumber,chainId:chainId,owner:account,spender:spender,tokenAddress:tokenAddress,permitType:permitInfo.type}));}));case 7:case\"end\":return _context.stop();}}},_callee);}));function gatherPermitSignature(){return _gatherPermitSignature.apply(this,arguments);}return gatherPermitSignature;}()};},[currencyAmount,eip2612Contract,account,chainId,isArgentWallet,transactionDeadline,library,tokenNonceState.loading,tokenNonceState.valid,tokenNonceState.result,tokenAddress,spender,permitInfo,signatureData]);}var REMOVE_V2_LIQUIDITY_PERMIT_INFO={version:'1',name:'Uniswap V2',type:PermitType.AMOUNT};export function useV2LiquidityTokenPermit(liquidityAmount,spender){return useERC20Permit(liquidityAmount,spender,REMOVE_V2_LIQUIDITY_PERMIT_INFO);}export function useERC20PermitFromTrade(trade,allowedSlippage){var _useActiveWeb3React2=useActiveWeb3React(),chainId=_useActiveWeb3React2.chainId;var swapRouterAddress=chainId?SWAP_ROUTER_ADDRESSES[chainId]:undefined;var amountToApprove=useMemo(function(){return trade?trade.maximumAmountIn(allowedSlippage):undefined;},[trade,allowedSlippage]);return useERC20Permit(amountToApprove,// v2 router does not support\ntrade instanceof V2Trade?undefined:trade instanceof V3Trade?swapRouterAddress:undefined,null);}","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/hooks/useERC20Permit.ts"],"names":["JSBI","Trade","V2Trade","V3Trade","splitSignature","useMemo","useState","SWAP_ROUTER_ADDRESSES","DAI","UNI","USDC","useSingleCallResult","useActiveWeb3React","useEIP2612Contract","useIsArgentWallet","useTransactionDeadline","PermitType","PERMIT_VALIDITY_BUFFER","PERMITTABLE_TOKENS","address","type","AMOUNT","name","version","ALLOWED","UseERC20PermitState","EIP712_DOMAIN_TYPE","EIP712_DOMAIN_TYPE_NO_VERSION","EIP2612_TYPE","PERMIT_ALLOWED_TYPE","useERC20Permit","currencyAmount","spender","overridePermitInfo","account","chainId","library","transactionDeadline","tokenAddress","currency","isToken","undefined","eip2612Contract","isArgentWallet","nonceInputs","tokenNonceState","permitInfo","signatureData","setSignatureData","valid","state","NOT_APPLICABLE","gatherPermitSignature","nonceNumber","result","toNumber","loading","LOADING","isSignatureDataValid","owner","deadline","nonce","equal","BigInt","amount","quotient","SIGNED","NOT_SIGNED","allowed","signatureDeadline","value","toString","message","holder","expiry","domain","verifyingContract","data","JSON","stringify","types","EIP712Domain","Permit","primaryType","send","then","signature","v","r","s","permitType","REMOVE_V2_LIQUIDITY_PERMIT_INFO","useV2LiquidityTokenPermit","liquidityAmount","useERC20PermitFromTrade","trade","allowedSlippage","swapRouterAddress","amountToApprove","maximumAmountIn"],"mappings":"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","sourcesContent":["import JSBI from 'jsbi'\nimport { Percent, CurrencyAmount, Currency, TradeType, Token } from '@uniswap/sdk-core'\nimport { Trade as V2Trade } from '@uniswap/v2-sdk'\nimport { Trade as V3Trade } from '@uniswap/v3-sdk'\nimport { splitSignature } from 'ethers/lib/utils'\nimport { useMemo, useState } from 'react'\nimport { SWAP_ROUTER_ADDRESSES } from '../constants/addresses'\nimport { DAI, UNI, USDC } from '../constants/tokens'\nimport { useSingleCallResult } from '../state/multicall/hooks'\nimport { useActiveWeb3React } from './web3'\nimport { useEIP2612Contract } from './useContract'\nimport useIsArgentWallet from './useIsArgentWallet'\nimport useTransactionDeadline from './useTransactionDeadline'\n\nenum PermitType {\n  AMOUNT = 1,\n  ALLOWED = 2,\n}\n\n// 20 minutes to submit after signing\nconst PERMIT_VALIDITY_BUFFER = 20 * 60\n\ninterface PermitInfo {\n  type: PermitType\n  name: string\n  // version is optional, and if omitted, will not be included in the domain\n  version?: string\n}\n\n// todo: read this information from extensions on token lists or elsewhere (permit registry?)\nconst PERMITTABLE_TOKENS: {\n  [chainId: number]: {\n    [checksummedTokenAddress: string]: PermitInfo\n  }\n} = {\n  [1]: {\n    [USDC.address]: { type: PermitType.AMOUNT, name: 'USD Coin', version: '2' },\n    [DAI.address]: { type: PermitType.ALLOWED, name: 'Dai Stablecoin', version: '1' },\n    [UNI[1].address]: { type: PermitType.AMOUNT, name: 'Uniswap' },\n  },\n  [4]: {\n    ['0xc7AD46e0b8a400Bb3C915120d284AafbA8fc4735']: { type: PermitType.ALLOWED, name: 'Dai Stablecoin', version: '1' },\n    [UNI[4].address]: { type: PermitType.AMOUNT, name: 'Uniswap' },\n  },\n  [3]: {\n    [UNI[3].address]: { type: PermitType.AMOUNT, name: 'Uniswap' },\n    ['0x07865c6E87B9F70255377e024ace6630C1Eaa37F']: { type: PermitType.AMOUNT, name: 'USD Coin', version: '2' },\n  },\n  [5]: {\n    [UNI[5].address]: { type: PermitType.AMOUNT, name: 'Uniswap' },\n  },\n  [42]: {\n    [UNI[42].address]: { type: PermitType.AMOUNT, name: 'Uniswap' },\n  },\n}\n\nexport enum UseERC20PermitState {\n  // returned for any reason, e.g. it is an argent wallet, or the currency does not support it\n  NOT_APPLICABLE,\n  LOADING,\n  NOT_SIGNED,\n  SIGNED,\n}\n\ninterface BaseSignatureData {\n  v: number\n  r: string\n  s: string\n  deadline: number\n  nonce: number\n  owner: string\n  spender: string\n  chainId: number\n  tokenAddress: string\n  permitType: PermitType\n}\n\ninterface StandardSignatureData extends BaseSignatureData {\n  amount: string\n}\n\ninterface AllowedSignatureData extends BaseSignatureData {\n  allowed: true\n}\n\nexport type SignatureData = StandardSignatureData | AllowedSignatureData\n\nconst EIP712_DOMAIN_TYPE = [\n  { name: 'name', type: 'string' },\n  { name: 'version', type: 'string' },\n  { name: 'chainId', type: 'uint256' },\n  { name: 'verifyingContract', type: 'address' },\n]\n\nconst EIP712_DOMAIN_TYPE_NO_VERSION = [\n  { name: 'name', type: 'string' },\n  { name: 'chainId', type: 'uint256' },\n  { name: 'verifyingContract', type: 'address' },\n]\n\nconst EIP2612_TYPE = [\n  { name: 'owner', type: 'address' },\n  { name: 'spender', type: 'address' },\n  { name: 'value', type: 'uint256' },\n  { name: 'nonce', type: 'uint256' },\n  { name: 'deadline', type: 'uint256' },\n]\n\nconst PERMIT_ALLOWED_TYPE = [\n  { name: 'holder', type: 'address' },\n  { name: 'spender', type: 'address' },\n  { name: 'nonce', type: 'uint256' },\n  { name: 'expiry', type: 'uint256' },\n  { name: 'allowed', type: 'bool' },\n]\n\nfunction useERC20Permit(\n  currencyAmount: CurrencyAmount<Currency> | null | undefined,\n  spender: string | null | undefined,\n  overridePermitInfo: PermitInfo | undefined | null\n): {\n  signatureData: SignatureData | null\n  state: UseERC20PermitState\n  gatherPermitSignature: null | (() => Promise<void>)\n} {\n  const { account, chainId, library } = useActiveWeb3React()\n  const transactionDeadline = useTransactionDeadline()\n  const tokenAddress = currencyAmount?.currency?.isToken ? currencyAmount.currency.address : undefined\n  const eip2612Contract = useEIP2612Contract(tokenAddress)\n  const isArgentWallet = useIsArgentWallet()\n  const nonceInputs = useMemo(() => [account ?? undefined], [account])\n  const tokenNonceState = useSingleCallResult(eip2612Contract, 'nonces', nonceInputs)\n  const permitInfo =\n    overridePermitInfo ?? (chainId && tokenAddress ? PERMITTABLE_TOKENS[chainId]?.[tokenAddress] : undefined)\n\n  const [signatureData, setSignatureData] = useState<SignatureData | null>(null)\n\n  return useMemo(() => {\n    if (\n      isArgentWallet ||\n      !currencyAmount ||\n      !eip2612Contract ||\n      !account ||\n      !chainId ||\n      !transactionDeadline ||\n      !library ||\n      !tokenNonceState.valid ||\n      !tokenAddress ||\n      !spender ||\n      !permitInfo\n    ) {\n      return {\n        state: UseERC20PermitState.NOT_APPLICABLE,\n        signatureData: null,\n        gatherPermitSignature: null,\n      }\n    }\n\n    const nonceNumber = tokenNonceState.result?.[0]?.toNumber()\n    if (tokenNonceState.loading || typeof nonceNumber !== 'number') {\n      return {\n        state: UseERC20PermitState.LOADING,\n        signatureData: null,\n        gatherPermitSignature: null,\n      }\n    }\n\n    const isSignatureDataValid =\n      signatureData &&\n      signatureData.owner === account &&\n      signatureData.deadline >= transactionDeadline.toNumber() &&\n      signatureData.tokenAddress === tokenAddress &&\n      signatureData.nonce === nonceNumber &&\n      signatureData.spender === spender &&\n      ('allowed' in signatureData || JSBI.equal(JSBI.BigInt(signatureData.amount), currencyAmount.quotient))\n\n    return {\n      state: isSignatureDataValid ? UseERC20PermitState.SIGNED : UseERC20PermitState.NOT_SIGNED,\n      signatureData: isSignatureDataValid ? signatureData : null,\n      gatherPermitSignature: async function gatherPermitSignature() {\n        const allowed = permitInfo.type === PermitType.ALLOWED\n        const signatureDeadline = transactionDeadline.toNumber() + PERMIT_VALIDITY_BUFFER\n        const value = currencyAmount.quotient.toString()\n\n        const message = allowed\n          ? {\n              holder: account,\n              spender,\n              allowed,\n              nonce: nonceNumber,\n              expiry: signatureDeadline,\n            }\n          : {\n              owner: account,\n              spender,\n              value,\n              nonce: nonceNumber,\n              deadline: signatureDeadline,\n            }\n        const domain = permitInfo.version\n          ? {\n              name: permitInfo.name,\n              version: permitInfo.version,\n              verifyingContract: tokenAddress,\n              chainId,\n            }\n          : {\n              name: permitInfo.name,\n              verifyingContract: tokenAddress,\n              chainId,\n            }\n        const data = JSON.stringify({\n          types: {\n            EIP712Domain: permitInfo.version ? EIP712_DOMAIN_TYPE : EIP712_DOMAIN_TYPE_NO_VERSION,\n            Permit: allowed ? PERMIT_ALLOWED_TYPE : EIP2612_TYPE,\n          },\n          domain,\n          primaryType: 'Permit',\n          message,\n        })\n\n        return library\n          .send('eth_signTypedData_v4', [account, data])\n          .then(splitSignature)\n          .then((signature) => {\n            setSignatureData({\n              v: signature.v,\n              r: signature.r,\n              s: signature.s,\n              deadline: signatureDeadline,\n              ...(allowed ? { allowed } : { amount: value }),\n              nonce: nonceNumber,\n              chainId,\n              owner: account,\n              spender,\n              tokenAddress,\n              permitType: permitInfo.type,\n            })\n          })\n      },\n    }\n  }, [\n    currencyAmount,\n    eip2612Contract,\n    account,\n    chainId,\n    isArgentWallet,\n    transactionDeadline,\n    library,\n    tokenNonceState.loading,\n    tokenNonceState.valid,\n    tokenNonceState.result,\n    tokenAddress,\n    spender,\n    permitInfo,\n    signatureData,\n  ])\n}\n\nconst REMOVE_V2_LIQUIDITY_PERMIT_INFO: PermitInfo = {\n  version: '1',\n  name: 'Uniswap V2',\n  type: PermitType.AMOUNT,\n}\n\nexport function useV2LiquidityTokenPermit(\n  liquidityAmount: CurrencyAmount<Token> | null | undefined,\n  spender: string | null | undefined\n) {\n  return useERC20Permit(liquidityAmount, spender, REMOVE_V2_LIQUIDITY_PERMIT_INFO)\n}\n\nexport function useERC20PermitFromTrade(\n  trade: V2Trade<Currency, Currency, TradeType> | V3Trade<Currency, Currency, TradeType> | undefined,\n  allowedSlippage: Percent\n) {\n  const { chainId } = useActiveWeb3React()\n  const swapRouterAddress = chainId ? SWAP_ROUTER_ADDRESSES[chainId] : undefined\n  const amountToApprove = useMemo(\n    () => (trade ? trade.maximumAmountIn(allowedSlippage) : undefined),\n    [trade, allowedSlippage]\n  )\n\n  return useERC20Permit(\n    amountToApprove,\n    // v2 router does not support\n    trade instanceof V2Trade ? undefined : trade instanceof V3Trade ? swapRouterAddress : undefined,\n    null\n  )\n}\n"]},"metadata":{},"sourceType":"module"}