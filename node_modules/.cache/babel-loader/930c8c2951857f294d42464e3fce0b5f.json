{"ast":null,"code":"import _regeneratorRuntime from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _styled from\"styled-components\";import{Trans}from\"@lingui/react\";import{i18n}from\"@lingui/core\";import{useState,useCallback}from'react';import{useV2LiquidityTokenPermit}from'../../hooks/useERC20Permit';import useTransactionDeadline from'../../hooks/useTransactionDeadline';import{formatCurrencyAmount}from'../../utils/formatCurrencyAmount';import Modal from'../Modal';import{AutoColumn}from'../Column';import{RowBetween}from'../Row';import{TYPE,CloseIcon}from'../../theme';import{ButtonConfirmed,ButtonError}from'../Button';import ProgressCircles from'../ProgressSteps';import CurrencyInputPanel from'../CurrencyInputPanel';import{Pair}from'@uniswap/v2-sdk';import{CurrencyAmount}from'@uniswap/sdk-core';import{useActiveWeb3React}from'../../hooks/web3';import{maxAmountSpend}from'../../utils/maxAmountSpend';import{usePairContract,useStakingContract,useV2RouterContract}from'../../hooks/useContract';import{useApproveCallback,ApprovalState}from'../../hooks/useApproveCallback';import{useDerivedStakeInfo}from'../../state/stake/hooks';import{useTransactionAdder}from'../../state/transactions/hooks';import{LoadingView,SubmittedView}from'../ModalViews';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var HypotheticalRewardRate=_styled.div.withConfig({componentId:\"sc-1uketpd-0\"})([\"display:flex;justify-content:space-between;padding-right:20px;padding-left:20px;opacity:\",\";\"],function(_ref){var dim=_ref.dim;return dim?0.5:1;});var ContentWrapper=_styled(AutoColumn).withConfig({componentId:\"sc-1uketpd-1\"})([\"width:100%;padding:1rem;\"]);export default function StakingModal(_ref2){var isOpen=_ref2.isOpen,onDismiss=_ref2.onDismiss,stakingInfo=_ref2.stakingInfo,userLiquidityUnstaked=_ref2.userLiquidityUnstaked;var _useActiveWeb3React=useActiveWeb3React(),library=_useActiveWeb3React.library;// track and parse user input\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),typedValue=_useState2[0],setTypedValue=_useState2[1];var _useDerivedStakeInfo=useDerivedStakeInfo(typedValue,stakingInfo.stakedAmount.currency,userLiquidityUnstaked),parsedAmount=_useDerivedStakeInfo.parsedAmount,error=_useDerivedStakeInfo.error;var parsedAmountWrapped=parsedAmount===null||parsedAmount===void 0?void 0:parsedAmount.wrapped;var hypotheticalRewardRate=CurrencyAmount.fromRawAmount(stakingInfo.rewardRate.currency,'0');if(parsedAmountWrapped===null||parsedAmountWrapped===void 0?void 0:parsedAmountWrapped.greaterThan('0')){hypotheticalRewardRate=stakingInfo.getHypotheticalRewardRate(stakingInfo.stakedAmount.add(parsedAmountWrapped),stakingInfo.totalStakedAmount.add(parsedAmountWrapped),stakingInfo.totalRewardRate);}// state for pending and submitted txn views\nvar addTransaction=useTransactionAdder();var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),attempting=_useState4[0],setAttempting=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),hash=_useState6[0],setHash=_useState6[1];var wrappedOnDismiss=useCallback(function(){setHash(undefined);setAttempting(false);onDismiss();},[onDismiss]);// pair contract for this token to be staked\nvar dummyPair=new Pair(CurrencyAmount.fromRawAmount(stakingInfo.tokens[0],'0'),CurrencyAmount.fromRawAmount(stakingInfo.tokens[1],'0'));var pairContract=usePairContract(dummyPair.liquidityToken.address);// approval data for stake\nvar deadline=useTransactionDeadline();var router=useV2RouterContract();var _useV2LiquidityTokenP=useV2LiquidityTokenPermit(parsedAmountWrapped,router===null||router===void 0?void 0:router.address),signatureData=_useV2LiquidityTokenP.signatureData,gatherPermitSignature=_useV2LiquidityTokenP.gatherPermitSignature;var _useApproveCallback=useApproveCallback(parsedAmount,stakingInfo.stakingRewardAddress),_useApproveCallback2=_slicedToArray(_useApproveCallback,2),approval=_useApproveCallback2[0],approveCallback=_useApproveCallback2[1];var stakingContract=useStakingContract(stakingInfo.stakingRewardAddress);function onStake(){return _onStake.apply(this,arguments);}// wrapped onUserInput to clear signatures\nfunction _onStake(){_onStake=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAttempting(true);if(!(stakingContract&&parsedAmount&&deadline)){_context.next=13;break;}if(!(approval===ApprovalState.APPROVED)){_context.next=7;break;}_context.next=5;return stakingContract.stake(\"0x\".concat(parsedAmount.quotient.toString(16)),{gasLimit:350000});case 5:_context.next=13;break;case 7:if(!signatureData){_context.next=11;break;}stakingContract.stakeWithPermit(\"0x\".concat(parsedAmount.quotient.toString(16)),signatureData.deadline,signatureData.v,signatureData.r,signatureData.s,{gasLimit:350000}).then(function(response){addTransaction(response,{summary:/*i18n*/i18n._(\"Deposit liquidity\")});setHash(response.hash);}).catch(function(error){setAttempting(false);console.log(error);});_context.next=13;break;case 11:setAttempting(false);throw new Error('Attempting to stake without approval or a signature. Please contact support.');case 13:case\"end\":return _context.stop();}}},_callee);}));return _onStake.apply(this,arguments);}var onUserInput=useCallback(function(typedValue){setTypedValue(typedValue);},[]);// used for max input button\nvar maxAmountInput=maxAmountSpend(userLiquidityUnstaked);var atMaxAmount=Boolean(maxAmountInput&&(parsedAmount===null||parsedAmount===void 0?void 0:parsedAmount.equalTo(maxAmountInput)));var handleMax=useCallback(function(){maxAmountInput&&onUserInput(maxAmountInput.toExact());},[maxAmountInput,onUserInput]);function onAttemptToApprove(){return _onAttemptToApprove.apply(this,arguments);}function _onAttemptToApprove(){_onAttemptToApprove=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(!pairContract||!library||!deadline)){_context2.next=2;break;}throw new Error('missing dependencies');case 2:if(parsedAmount){_context2.next=4;break;}throw new Error('missing liquidity amount');case 4:if(!gatherPermitSignature){_context2.next=17;break;}_context2.prev=5;_context2.next=8;return gatherPermitSignature();case 8:_context2.next=15;break;case 10:_context2.prev=10;_context2.t0=_context2[\"catch\"](5);if(!((_context2.t0===null||_context2.t0===void 0?void 0:_context2.t0.code)!==4001)){_context2.next=15;break;}_context2.next=15;return approveCallback();case 15:_context2.next=19;break;case 17:_context2.next=19;return approveCallback();case 19:case\"end\":return _context2.stop();}}},_callee2,null,[[5,10]]);}));return _onAttemptToApprove.apply(this,arguments);}return/*#__PURE__*/_jsxs(Modal,{isOpen:isOpen,onDismiss:wrappedOnDismiss,maxHeight:90,children:[!attempting&&!hash&&/*#__PURE__*/_jsxs(ContentWrapper,{gap:\"lg\",children:[/*#__PURE__*/_jsxs(RowBetween,{children:[/*#__PURE__*/_jsx(TYPE.mediumHeader,{children:/*#__PURE__*/_jsx(Trans,{id:\"Deposit\"})}),/*#__PURE__*/_jsx(CloseIcon,{onClick:wrappedOnDismiss})]}),/*#__PURE__*/_jsx(CurrencyInputPanel,{value:typedValue,onUserInput:onUserInput,onMax:handleMax,showMaxButton:!atMaxAmount,currency:stakingInfo.stakedAmount.currency,pair:dummyPair,label:'',renderBalance:function renderBalance(amount){return/*#__PURE__*/_jsx(Trans,{id:\"Available to deposit: {0}\",values:{0:formatCurrencyAmount(amount,4)}});},id:\"stake-liquidity-token\"}),/*#__PURE__*/_jsxs(HypotheticalRewardRate,{dim:!hypotheticalRewardRate.greaterThan('0'),children:[/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(TYPE.black,{fontWeight:600,children:/*#__PURE__*/_jsx(Trans,{id:\"Weekly Rewards\"})})}),/*#__PURE__*/_jsx(TYPE.black,{children:/*#__PURE__*/_jsx(Trans,{id:\"{0} UNI / week\",values:{0:hypotheticalRewardRate.multiply((60*60*24*7).toString()).toSignificant(4,{groupSeparator:','})}})})]}),/*#__PURE__*/_jsxs(RowBetween,{children:[/*#__PURE__*/_jsx(ButtonConfirmed,{mr:\"0.5rem\",onClick:onAttemptToApprove,confirmed:approval===ApprovalState.APPROVED||signatureData!==null,disabled:approval!==ApprovalState.NOT_APPROVED||signatureData!==null,children:/*#__PURE__*/_jsx(Trans,{id:\"Approve\"})}),/*#__PURE__*/_jsx(ButtonError,{disabled:!!error||signatureData===null&&approval!==ApprovalState.APPROVED,error:!!error&&!!parsedAmount,onClick:onStake,children:error!==null&&error!==void 0?error:/*#__PURE__*/_jsx(Trans,{id:\"Deposit\"})})]}),/*#__PURE__*/_jsx(ProgressCircles,{steps:[approval===ApprovalState.APPROVED||signatureData!==null],disabled:true})]}),attempting&&!hash&&/*#__PURE__*/_jsx(LoadingView,{onDismiss:wrappedOnDismiss,children:/*#__PURE__*/_jsxs(AutoColumn,{gap:\"12px\",justify:'center',children:[/*#__PURE__*/_jsx(TYPE.largeHeader,{children:/*#__PURE__*/_jsx(Trans,{id:\"Depositing Liquidity\"})}),/*#__PURE__*/_jsx(TYPE.body,{fontSize:20,children:/*#__PURE__*/_jsx(Trans,{id:\"{0} UNI-V2\",values:{0:parsedAmount===null||parsedAmount===void 0?void 0:parsedAmount.toSignificant(4)}})})]})}),attempting&&hash&&/*#__PURE__*/_jsx(SubmittedView,{onDismiss:wrappedOnDismiss,hash:hash,children:/*#__PURE__*/_jsxs(AutoColumn,{gap:\"12px\",justify:'center',children:[/*#__PURE__*/_jsx(TYPE.largeHeader,{children:/*#__PURE__*/_jsx(Trans,{id:\"Transaction Submitted\"})}),/*#__PURE__*/_jsx(TYPE.body,{fontSize:20,children:/*#__PURE__*/_jsx(Trans,{id:\"Deposited {0} UNI-V2\",values:{0:parsedAmount===null||parsedAmount===void 0?void 0:parsedAmount.toSignificant(4)}})})]})})]});}","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/components/earn/StakingModal.tsx"],"names":["useState","useCallback","useV2LiquidityTokenPermit","useTransactionDeadline","formatCurrencyAmount","Modal","AutoColumn","RowBetween","TYPE","CloseIcon","ButtonConfirmed","ButtonError","ProgressCircles","CurrencyInputPanel","Pair","CurrencyAmount","useActiveWeb3React","maxAmountSpend","usePairContract","useStakingContract","useV2RouterContract","useApproveCallback","ApprovalState","useDerivedStakeInfo","useTransactionAdder","LoadingView","SubmittedView","HypotheticalRewardRate","styled","div","dim","ContentWrapper","StakingModal","isOpen","onDismiss","stakingInfo","userLiquidityUnstaked","library","typedValue","setTypedValue","stakedAmount","currency","parsedAmount","error","parsedAmountWrapped","wrapped","hypotheticalRewardRate","fromRawAmount","rewardRate","greaterThan","getHypotheticalRewardRate","add","totalStakedAmount","totalRewardRate","addTransaction","attempting","setAttempting","hash","setHash","wrappedOnDismiss","undefined","dummyPair","tokens","pairContract","liquidityToken","address","deadline","router","signatureData","gatherPermitSignature","stakingRewardAddress","approval","approveCallback","stakingContract","onStake","APPROVED","stake","quotient","toString","gasLimit","stakeWithPermit","v","r","s","then","response","summary","catch","console","log","Error","onUserInput","maxAmountInput","atMaxAmount","Boolean","equalTo","handleMax","toExact","onAttemptToApprove","code","amount","multiply","toSignificant","groupSeparator","NOT_APPROVED"],"mappings":"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","sourcesContent":["import { useState, useCallback } from 'react'\nimport { useV2LiquidityTokenPermit } from '../../hooks/useERC20Permit'\nimport useTransactionDeadline from '../../hooks/useTransactionDeadline'\nimport { formatCurrencyAmount } from '../../utils/formatCurrencyAmount'\nimport Modal from '../Modal'\nimport { AutoColumn } from '../Column'\nimport styled from 'styled-components/macro'\nimport { RowBetween } from '../Row'\nimport { TYPE, CloseIcon } from '../../theme'\nimport { ButtonConfirmed, ButtonError } from '../Button'\nimport ProgressCircles from '../ProgressSteps'\nimport CurrencyInputPanel from '../CurrencyInputPanel'\nimport { Pair } from '@uniswap/v2-sdk'\nimport { Token, CurrencyAmount } from '@uniswap/sdk-core'\nimport { useActiveWeb3React } from '../../hooks/web3'\nimport { maxAmountSpend } from '../../utils/maxAmountSpend'\nimport { usePairContract, useStakingContract, useV2RouterContract } from '../../hooks/useContract'\nimport { useApproveCallback, ApprovalState } from '../../hooks/useApproveCallback'\nimport { StakingInfo, useDerivedStakeInfo } from '../../state/stake/hooks'\nimport { TransactionResponse } from '@ethersproject/providers'\nimport { useTransactionAdder } from '../../state/transactions/hooks'\nimport { LoadingView, SubmittedView } from '../ModalViews'\nimport { t, Trans } from '@lingui/macro'\n\nconst HypotheticalRewardRate = styled.div<{ dim: boolean }>`\n  display: flex;\n  justify-content: space-between;\n  padding-right: 20px;\n  padding-left: 20px;\n\n  opacity: ${({ dim }) => (dim ? 0.5 : 1)};\n`\n\nconst ContentWrapper = styled(AutoColumn)`\n  width: 100%;\n  padding: 1rem;\n`\n\ninterface StakingModalProps {\n  isOpen: boolean\n  onDismiss: () => void\n  stakingInfo: StakingInfo\n  userLiquidityUnstaked: CurrencyAmount<Token> | undefined\n}\n\nexport default function StakingModal({ isOpen, onDismiss, stakingInfo, userLiquidityUnstaked }: StakingModalProps) {\n  const { library } = useActiveWeb3React()\n\n  // track and parse user input\n  const [typedValue, setTypedValue] = useState('')\n  const { parsedAmount, error } = useDerivedStakeInfo(\n    typedValue,\n    stakingInfo.stakedAmount.currency,\n    userLiquidityUnstaked\n  )\n  const parsedAmountWrapped = parsedAmount?.wrapped\n\n  let hypotheticalRewardRate: CurrencyAmount<Token> = CurrencyAmount.fromRawAmount(stakingInfo.rewardRate.currency, '0')\n  if (parsedAmountWrapped?.greaterThan('0')) {\n    hypotheticalRewardRate = stakingInfo.getHypotheticalRewardRate(\n      stakingInfo.stakedAmount.add(parsedAmountWrapped),\n      stakingInfo.totalStakedAmount.add(parsedAmountWrapped),\n      stakingInfo.totalRewardRate\n    )\n  }\n\n  // state for pending and submitted txn views\n  const addTransaction = useTransactionAdder()\n  const [attempting, setAttempting] = useState<boolean>(false)\n  const [hash, setHash] = useState<string | undefined>()\n  const wrappedOnDismiss = useCallback(() => {\n    setHash(undefined)\n    setAttempting(false)\n    onDismiss()\n  }, [onDismiss])\n\n  // pair contract for this token to be staked\n  const dummyPair = new Pair(\n    CurrencyAmount.fromRawAmount(stakingInfo.tokens[0], '0'),\n    CurrencyAmount.fromRawAmount(stakingInfo.tokens[1], '0')\n  )\n  const pairContract = usePairContract(dummyPair.liquidityToken.address)\n\n  // approval data for stake\n  const deadline = useTransactionDeadline()\n  const router = useV2RouterContract()\n  const { signatureData, gatherPermitSignature } = useV2LiquidityTokenPermit(parsedAmountWrapped, router?.address)\n  const [approval, approveCallback] = useApproveCallback(parsedAmount, stakingInfo.stakingRewardAddress)\n\n  const stakingContract = useStakingContract(stakingInfo.stakingRewardAddress)\n  async function onStake() {\n    setAttempting(true)\n    if (stakingContract && parsedAmount && deadline) {\n      if (approval === ApprovalState.APPROVED) {\n        await stakingContract.stake(`0x${parsedAmount.quotient.toString(16)}`, { gasLimit: 350000 })\n      } else if (signatureData) {\n        stakingContract\n          .stakeWithPermit(\n            `0x${parsedAmount.quotient.toString(16)}`,\n            signatureData.deadline,\n            signatureData.v,\n            signatureData.r,\n            signatureData.s,\n            { gasLimit: 350000 }\n          )\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: t`Deposit liquidity`,\n            })\n            setHash(response.hash)\n          })\n          .catch((error: any) => {\n            setAttempting(false)\n            console.log(error)\n          })\n      } else {\n        setAttempting(false)\n        throw new Error('Attempting to stake without approval or a signature. Please contact support.')\n      }\n    }\n  }\n\n  // wrapped onUserInput to clear signatures\n  const onUserInput = useCallback((typedValue: string) => {\n    setTypedValue(typedValue)\n  }, [])\n\n  // used for max input button\n  const maxAmountInput = maxAmountSpend(userLiquidityUnstaked)\n  const atMaxAmount = Boolean(maxAmountInput && parsedAmount?.equalTo(maxAmountInput))\n  const handleMax = useCallback(() => {\n    maxAmountInput && onUserInput(maxAmountInput.toExact())\n  }, [maxAmountInput, onUserInput])\n\n  async function onAttemptToApprove() {\n    if (!pairContract || !library || !deadline) throw new Error('missing dependencies')\n    if (!parsedAmount) throw new Error('missing liquidity amount')\n\n    if (gatherPermitSignature) {\n      try {\n        await gatherPermitSignature()\n      } catch (error) {\n        // try to approve if gatherPermitSignature failed for any reason other than the user rejecting it\n        if (error?.code !== 4001) {\n          await approveCallback()\n        }\n      }\n    } else {\n      await approveCallback()\n    }\n  }\n\n  return (\n    <Modal isOpen={isOpen} onDismiss={wrappedOnDismiss} maxHeight={90}>\n      {!attempting && !hash && (\n        <ContentWrapper gap=\"lg\">\n          <RowBetween>\n            <TYPE.mediumHeader>\n              <Trans>Deposit</Trans>\n            </TYPE.mediumHeader>\n            <CloseIcon onClick={wrappedOnDismiss} />\n          </RowBetween>\n          <CurrencyInputPanel\n            value={typedValue}\n            onUserInput={onUserInput}\n            onMax={handleMax}\n            showMaxButton={!atMaxAmount}\n            currency={stakingInfo.stakedAmount.currency}\n            pair={dummyPair}\n            label={''}\n            renderBalance={(amount) => <Trans>Available to deposit: {formatCurrencyAmount(amount, 4)}</Trans>}\n            id=\"stake-liquidity-token\"\n          />\n\n          <HypotheticalRewardRate dim={!hypotheticalRewardRate.greaterThan('0')}>\n            <div>\n              <TYPE.black fontWeight={600}>\n                <Trans>Weekly Rewards</Trans>\n              </TYPE.black>\n            </div>\n\n            <TYPE.black>\n              <Trans>\n                {hypotheticalRewardRate\n                  .multiply((60 * 60 * 24 * 7).toString())\n                  .toSignificant(4, { groupSeparator: ',' })}{' '}\n                UNI / week\n              </Trans>\n            </TYPE.black>\n          </HypotheticalRewardRate>\n\n          <RowBetween>\n            <ButtonConfirmed\n              mr=\"0.5rem\"\n              onClick={onAttemptToApprove}\n              confirmed={approval === ApprovalState.APPROVED || signatureData !== null}\n              disabled={approval !== ApprovalState.NOT_APPROVED || signatureData !== null}\n            >\n              <Trans>Approve</Trans>\n            </ButtonConfirmed>\n            <ButtonError\n              disabled={!!error || (signatureData === null && approval !== ApprovalState.APPROVED)}\n              error={!!error && !!parsedAmount}\n              onClick={onStake}\n            >\n              {error ?? <Trans>Deposit</Trans>}\n            </ButtonError>\n          </RowBetween>\n          <ProgressCircles steps={[approval === ApprovalState.APPROVED || signatureData !== null]} disabled={true} />\n        </ContentWrapper>\n      )}\n      {attempting && !hash && (\n        <LoadingView onDismiss={wrappedOnDismiss}>\n          <AutoColumn gap=\"12px\" justify={'center'}>\n            <TYPE.largeHeader>\n              <Trans>Depositing Liquidity</Trans>\n            </TYPE.largeHeader>\n            <TYPE.body fontSize={20}>\n              <Trans>{parsedAmount?.toSignificant(4)} UNI-V2</Trans>\n            </TYPE.body>\n          </AutoColumn>\n        </LoadingView>\n      )}\n      {attempting && hash && (\n        <SubmittedView onDismiss={wrappedOnDismiss} hash={hash}>\n          <AutoColumn gap=\"12px\" justify={'center'}>\n            <TYPE.largeHeader>\n              <Trans>Transaction Submitted</Trans>\n            </TYPE.largeHeader>\n            <TYPE.body fontSize={20}>\n              <Trans>Deposited {parsedAmount?.toSignificant(4)} UNI-V2</Trans>\n            </TYPE.body>\n          </AutoColumn>\n        </SubmittedView>\n      )}\n    </Modal>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}