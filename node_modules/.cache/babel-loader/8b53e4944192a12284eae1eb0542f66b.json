{"ast":null,"code":"import _toConsumableArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{ThemeContext as _ThemeContext}from\"styled-components\";import{Trans}from\"@lingui/react\";import{useContext,useMemo}from'react';import{Token}from'@uniswap/sdk-core';import{AutoColumn}from'../../components/Column';import{AutoRow}from'../../components/Row';import{Text}from'rebass';import{V2_FACTORY_ADDRESSES}from'../../constants/addresses';import{useActiveWeb3React}from'../../hooks/web3';import{useTokenBalancesWithLoadingIndicator}from'../../state/wallet/hooks';import{BackArrow,StyledInternalLink,TYPE}from'../../theme';import{LightCard}from'../../components/Card';import{BodyWrapper}from'../AppBody';import QuestionHelper from'../../components/QuestionHelper';import{Dots}from'../../components/swap/styleds';import{toV2LiquidityToken,useTrackedTokenPairs}from'../../state/user/hooks';import MigrateV2PositionCard from'components/PositionCard/V2';import MigrateSushiPositionCard from'components/PositionCard/Sushi';import{SwitchLocaleLink}from'components/SwitchLocaleLink';import{PairState,useV2Pairs}from'hooks/useV2Pairs';import{getCreate2Address}from'@ethersproject/address';import{pack,keccak256}from'@ethersproject/solidity';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function EmptyState(_ref){var message=_ref.message;return/*#__PURE__*/_jsx(AutoColumn,{style:{minHeight:200,justifyContent:'center',alignItems:'center'},children:/*#__PURE__*/_jsx(TYPE.body,{children:message})});}// quick hack because sushi init code hash is different\nvar computeSushiPairAddress=function computeSushiPairAddress(_ref2){var tokenA=_ref2.tokenA,tokenB=_ref2.tokenB;var _ref3=tokenA.sortsBefore(tokenB)?[tokenA,tokenB]:[tokenB,tokenA],_ref4=_slicedToArray(_ref3,2),token0=_ref4[0],token1=_ref4[1];// does safety checks\nreturn getCreate2Address('0xC0AEe478e3658e2610c5F7A4A2E1777cE9e4f2Ac',keccak256(['bytes'],[pack(['address','address'],[token0.address,token1.address])]),'0xb91a506863cfcbe10e50423bae39b949ec921db270a3f040b31bede2bbdda68c');};/**\n * Given two tokens return the sushiswap liquidity token that represents its liquidity shares\n * @param tokenA one of the two tokens\n * @param tokenB the other token\n */function toSushiLiquidityToken(_ref5){var _ref6=_slicedToArray(_ref5,2),tokenA=_ref6[0],tokenB=_ref6[1];return new Token(tokenA.chainId,computeSushiPairAddress({tokenA:tokenA,tokenB:tokenB}),18,'SLP','SushiSwap LP Token');}export default function MigrateV2(){var theme=useContext(_ThemeContext);var _useActiveWeb3React=useActiveWeb3React(),account=_useActiveWeb3React.account,chainId=_useActiveWeb3React.chainId;var v2FactoryAddress=chainId?V2_FACTORY_ADDRESSES[chainId]:undefined;// fetch the user's balances of all tracked V2 LP tokens\nvar trackedTokenPairs=useTrackedTokenPairs();// calculate v2 + sushi pair contract addresses for all token pairs\nvar tokenPairsWithLiquidityTokens=useMemo(function(){return trackedTokenPairs.map(function(tokens){// sushi liquidity token or null\nvar sushiLiquidityToken=chainId===1?toSushiLiquidityToken(tokens):null;return{v2liquidityToken:v2FactoryAddress?toV2LiquidityToken(tokens):undefined,sushiLiquidityToken:sushiLiquidityToken,tokens:tokens};});},[trackedTokenPairs,chainId,v2FactoryAddress]);//  get pair liquidity token addresses for balance-fetching purposes\nvar allLiquidityTokens=useMemo(function(){var v2=tokenPairsWithLiquidityTokens.map(function(_ref7){var v2liquidityToken=_ref7.v2liquidityToken;return v2liquidityToken;});var sushi=tokenPairsWithLiquidityTokens.map(function(_ref8){var sushiLiquidityToken=_ref8.sushiLiquidityToken;return sushiLiquidityToken;}).filter(function(token){return!!token;});return[].concat(_toConsumableArray(v2),_toConsumableArray(sushi));},[tokenPairsWithLiquidityTokens]);// fetch pair balances\nvar _useTokenBalancesWith=useTokenBalancesWithLoadingIndicator(account!==null&&account!==void 0?account:undefined,allLiquidityTokens),_useTokenBalancesWith2=_slicedToArray(_useTokenBalancesWith,2),pairBalances=_useTokenBalancesWith2[0],fetchingPairBalances=_useTokenBalancesWith2[1];// filter for v2 liquidity tokens that the user has a balance in\nvar tokenPairsWithV2Balance=useMemo(function(){if(fetchingPairBalances)return[];return tokenPairsWithLiquidityTokens.filter(function(_ref9){var _pairBalances$v2liqui;var v2liquidityToken=_ref9.v2liquidityToken;return v2liquidityToken&&((_pairBalances$v2liqui=pairBalances[v2liquidityToken.address])===null||_pairBalances$v2liqui===void 0?void 0:_pairBalances$v2liqui.greaterThan(0));}).map(function(tokenPairsWithLiquidityTokens){return tokenPairsWithLiquidityTokens.tokens;});},[fetchingPairBalances,tokenPairsWithLiquidityTokens,pairBalances]);// filter for v2 liquidity tokens that the user has a balance in\nvar tokenPairsWithSushiBalance=useMemo(function(){if(fetchingPairBalances)return[];return tokenPairsWithLiquidityTokens.filter(function(_ref10){var _pairBalances$sushiLi;var sushiLiquidityToken=_ref10.sushiLiquidityToken;return!!sushiLiquidityToken&&((_pairBalances$sushiLi=pairBalances[sushiLiquidityToken.address])===null||_pairBalances$sushiLi===void 0?void 0:_pairBalances$sushiLi.greaterThan(0));});},[fetchingPairBalances,tokenPairsWithLiquidityTokens,pairBalances]);var v2Pairs=useV2Pairs(tokenPairsWithV2Balance);var v2IsLoading=fetchingPairBalances||v2Pairs.some(function(_ref11){var _ref12=_slicedToArray(_ref11,1),pairState=_ref12[0];return pairState===PairState.LOADING;});return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(BodyWrapper,{style:{padding:24},children:/*#__PURE__*/_jsxs(AutoColumn,{gap:\"16px\",children:[/*#__PURE__*/_jsxs(AutoRow,{style:{alignItems:'center',justifyContent:'space-between'},gap:\"8px\",children:[/*#__PURE__*/_jsx(BackArrow,{to:\"/pool/v2\"}),/*#__PURE__*/_jsx(TYPE.mediumHeader,{children:/*#__PURE__*/_jsx(Trans,{id:\"Migrate V2 Liquidity\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(QuestionHelper,{text:/*#__PURE__*/_jsx(Trans,{id:\"Migrate your liquidity tokens from Uniswap V2 to Uniswap V3.\"})})})]}),/*#__PURE__*/_jsx(TYPE.body,{style:{marginBottom:8,fontWeight:400},children:/*#__PURE__*/_jsx(Trans,{id:\"For each pool shown below, click migrate to remove your liquidity from Uniswap V2 and deposit it into Uniswap V3.\"})}),!account?/*#__PURE__*/_jsx(LightCard,{padding:\"40px\",children:/*#__PURE__*/_jsx(TYPE.body,{color:theme.text3,textAlign:\"center\",children:/*#__PURE__*/_jsx(Trans,{id:\"Connect to a wallet to view your V2 liquidity.\"})})}):v2IsLoading?/*#__PURE__*/_jsx(LightCard,{padding:\"40px\",children:/*#__PURE__*/_jsx(TYPE.body,{color:theme.text3,textAlign:\"center\",children:/*#__PURE__*/_jsx(Dots,{children:/*#__PURE__*/_jsx(Trans,{id:\"Loading\"})})})}):v2Pairs.filter(function(_ref13){var _ref14=_slicedToArray(_ref13,2),pair=_ref14[1];return!!pair;}).length>0?/*#__PURE__*/_jsxs(_Fragment,{children:[v2Pairs.filter(function(_ref15){var _ref16=_slicedToArray(_ref15,2),pair=_ref16[1];return!!pair;}).map(function(_ref17){var _ref18=_slicedToArray(_ref17,2),pair=_ref18[1];return/*#__PURE__*/_jsx(MigrateV2PositionCard,{pair:pair},pair.liquidityToken.address);}),tokenPairsWithSushiBalance.map(function(_ref19){var sushiLiquidityToken=_ref19.sushiLiquidityToken,tokens=_ref19.tokens;return/*#__PURE__*/_jsx(MigrateSushiPositionCard,{tokenA:tokens[0],tokenB:tokens[1],liquidityToken:sushiLiquidityToken},sushiLiquidityToken.address);})]}):/*#__PURE__*/_jsx(EmptyState,{message:/*#__PURE__*/_jsx(Trans,{id:\"No V2 Liquidity found.\"})}),/*#__PURE__*/_jsx(AutoColumn,{justify:'center',gap:\"md\",children:/*#__PURE__*/_jsx(Text,{textAlign:\"center\",fontSize:14,style:{padding:'.5rem 0 .5rem 0'},children:/*#__PURE__*/_jsx(Trans,{id:\"Don\\u2019t see one of your v2 positions? <0>Import it.</0>\",components:{0:/*#__PURE__*/_jsx(StyledInternalLink,{id:\"import-pool-link\",to:'/find?origin=/migrate/v2'})}})})})]})}),/*#__PURE__*/_jsx(SwitchLocaleLink,{})]});}","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/pages/MigrateV2/index.tsx"],"names":["useContext","useMemo","Token","AutoColumn","AutoRow","Text","V2_FACTORY_ADDRESSES","useActiveWeb3React","useTokenBalancesWithLoadingIndicator","BackArrow","StyledInternalLink","TYPE","LightCard","BodyWrapper","QuestionHelper","Dots","toV2LiquidityToken","useTrackedTokenPairs","MigrateV2PositionCard","MigrateSushiPositionCard","SwitchLocaleLink","PairState","useV2Pairs","getCreate2Address","pack","keccak256","EmptyState","message","minHeight","justifyContent","alignItems","computeSushiPairAddress","tokenA","tokenB","sortsBefore","token0","token1","address","toSushiLiquidityToken","chainId","MigrateV2","theme","ThemeContext","account","v2FactoryAddress","undefined","trackedTokenPairs","tokenPairsWithLiquidityTokens","map","tokens","sushiLiquidityToken","v2liquidityToken","allLiquidityTokens","v2","sushi","filter","token","pairBalances","fetchingPairBalances","tokenPairsWithV2Balance","greaterThan","tokenPairsWithSushiBalance","v2Pairs","v2IsLoading","some","pairState","LOADING","padding","marginBottom","fontWeight","text3","pair","length","liquidityToken"],"mappings":"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","sourcesContent":["import { ReactNode, useContext, useMemo } from 'react'\nimport { Pair } from '@uniswap/v2-sdk'\nimport { Token } from '@uniswap/sdk-core'\nimport { ThemeContext } from 'styled-components/macro'\nimport { AutoColumn } from '../../components/Column'\nimport { AutoRow } from '../../components/Row'\nimport { Text } from 'rebass'\nimport { V2_FACTORY_ADDRESSES } from '../../constants/addresses'\nimport { useActiveWeb3React } from '../../hooks/web3'\nimport { useTokenBalancesWithLoadingIndicator } from '../../state/wallet/hooks'\nimport { BackArrow, StyledInternalLink, TYPE } from '../../theme'\nimport { LightCard } from '../../components/Card'\nimport { BodyWrapper } from '../AppBody'\nimport QuestionHelper from '../../components/QuestionHelper'\nimport { Dots } from '../../components/swap/styleds'\nimport { toV2LiquidityToken, useTrackedTokenPairs } from '../../state/user/hooks'\nimport MigrateV2PositionCard from 'components/PositionCard/V2'\nimport MigrateSushiPositionCard from 'components/PositionCard/Sushi'\nimport { SwitchLocaleLink } from 'components/SwitchLocaleLink'\nimport { PairState, useV2Pairs } from 'hooks/useV2Pairs'\nimport { getCreate2Address } from '@ethersproject/address'\nimport { pack, keccak256 } from '@ethersproject/solidity'\nimport { Trans } from '@lingui/macro'\n\nfunction EmptyState({ message }: { message: ReactNode }) {\n  return (\n    <AutoColumn style={{ minHeight: 200, justifyContent: 'center', alignItems: 'center' }}>\n      <TYPE.body>{message}</TYPE.body>\n    </AutoColumn>\n  )\n}\n\n// quick hack because sushi init code hash is different\nconst computeSushiPairAddress = ({ tokenA, tokenB }: { tokenA: Token; tokenB: Token }): string => {\n  const [token0, token1] = tokenA.sortsBefore(tokenB) ? [tokenA, tokenB] : [tokenB, tokenA] // does safety checks\n  return getCreate2Address(\n    '0xC0AEe478e3658e2610c5F7A4A2E1777cE9e4f2Ac',\n    keccak256(['bytes'], [pack(['address', 'address'], [token0.address, token1.address])]),\n    '0xb91a506863cfcbe10e50423bae39b949ec921db270a3f040b31bede2bbdda68c'\n  )\n}\n\n/**\n * Given two tokens return the sushiswap liquidity token that represents its liquidity shares\n * @param tokenA one of the two tokens\n * @param tokenB the other token\n */\nfunction toSushiLiquidityToken([tokenA, tokenB]: [Token, Token]): Token {\n  return new Token(tokenA.chainId, computeSushiPairAddress({ tokenA, tokenB }), 18, 'SLP', 'SushiSwap LP Token')\n}\n\nexport default function MigrateV2() {\n  const theme = useContext(ThemeContext)\n  const { account, chainId } = useActiveWeb3React()\n\n  const v2FactoryAddress = chainId ? V2_FACTORY_ADDRESSES[chainId] : undefined\n\n  // fetch the user's balances of all tracked V2 LP tokens\n  const trackedTokenPairs = useTrackedTokenPairs()\n\n  // calculate v2 + sushi pair contract addresses for all token pairs\n  const tokenPairsWithLiquidityTokens = useMemo(\n    () =>\n      trackedTokenPairs.map((tokens) => {\n        // sushi liquidity token or null\n        const sushiLiquidityToken = chainId === 1 ? toSushiLiquidityToken(tokens) : null\n        return {\n          v2liquidityToken: v2FactoryAddress ? toV2LiquidityToken(tokens) : undefined,\n          sushiLiquidityToken,\n          tokens,\n        }\n      }),\n    [trackedTokenPairs, chainId, v2FactoryAddress]\n  )\n\n  //  get pair liquidity token addresses for balance-fetching purposes\n  const allLiquidityTokens = useMemo(() => {\n    const v2 = tokenPairsWithLiquidityTokens.map(({ v2liquidityToken }) => v2liquidityToken)\n    const sushi = tokenPairsWithLiquidityTokens\n      .map(({ sushiLiquidityToken }) => sushiLiquidityToken)\n      .filter((token): token is Token => !!token)\n\n    return [...v2, ...sushi]\n  }, [tokenPairsWithLiquidityTokens])\n\n  // fetch pair balances\n  const [pairBalances, fetchingPairBalances] = useTokenBalancesWithLoadingIndicator(\n    account ?? undefined,\n    allLiquidityTokens\n  )\n\n  // filter for v2 liquidity tokens that the user has a balance in\n  const tokenPairsWithV2Balance = useMemo(() => {\n    if (fetchingPairBalances) return []\n\n    return tokenPairsWithLiquidityTokens\n      .filter(({ v2liquidityToken }) => v2liquidityToken && pairBalances[v2liquidityToken.address]?.greaterThan(0))\n      .map((tokenPairsWithLiquidityTokens) => tokenPairsWithLiquidityTokens.tokens)\n  }, [fetchingPairBalances, tokenPairsWithLiquidityTokens, pairBalances])\n\n  // filter for v2 liquidity tokens that the user has a balance in\n  const tokenPairsWithSushiBalance = useMemo(() => {\n    if (fetchingPairBalances) return []\n\n    return tokenPairsWithLiquidityTokens.filter(\n      ({ sushiLiquidityToken }) => !!sushiLiquidityToken && pairBalances[sushiLiquidityToken.address]?.greaterThan(0)\n    )\n  }, [fetchingPairBalances, tokenPairsWithLiquidityTokens, pairBalances])\n\n  const v2Pairs = useV2Pairs(tokenPairsWithV2Balance)\n  const v2IsLoading = fetchingPairBalances || v2Pairs.some(([pairState]) => pairState === PairState.LOADING)\n\n  return (\n    <>\n      <BodyWrapper style={{ padding: 24 }}>\n        <AutoColumn gap=\"16px\">\n          <AutoRow style={{ alignItems: 'center', justifyContent: 'space-between' }} gap=\"8px\">\n            <BackArrow to=\"/pool/v2\" />\n            <TYPE.mediumHeader>\n              <Trans>Migrate V2 Liquidity</Trans>\n            </TYPE.mediumHeader>\n            <div>\n              <QuestionHelper text={<Trans>Migrate your liquidity tokens from Uniswap V2 to Uniswap V3.</Trans>} />\n            </div>\n          </AutoRow>\n\n          <TYPE.body style={{ marginBottom: 8, fontWeight: 400 }}>\n            <Trans>\n              For each pool shown below, click migrate to remove your liquidity from Uniswap V2 and deposit it into\n              Uniswap V3.\n            </Trans>\n          </TYPE.body>\n\n          {!account ? (\n            <LightCard padding=\"40px\">\n              <TYPE.body color={theme.text3} textAlign=\"center\">\n                <Trans>Connect to a wallet to view your V2 liquidity.</Trans>\n              </TYPE.body>\n            </LightCard>\n          ) : v2IsLoading ? (\n            <LightCard padding=\"40px\">\n              <TYPE.body color={theme.text3} textAlign=\"center\">\n                <Dots>\n                  <Trans>Loading</Trans>\n                </Dots>\n              </TYPE.body>\n            </LightCard>\n          ) : v2Pairs.filter(([, pair]) => !!pair).length > 0 ? (\n            <>\n              {v2Pairs\n                .filter(([, pair]) => !!pair)\n                .map(([, pair]) => (\n                  <MigrateV2PositionCard key={(pair as Pair).liquidityToken.address} pair={pair as Pair} />\n                ))}\n\n              {tokenPairsWithSushiBalance.map(({ sushiLiquidityToken, tokens }) => {\n                return (\n                  <MigrateSushiPositionCard\n                    key={(sushiLiquidityToken as Token).address}\n                    tokenA={tokens[0]}\n                    tokenB={tokens[1]}\n                    liquidityToken={sushiLiquidityToken as Token}\n                  />\n                )\n              })}\n            </>\n          ) : (\n            <EmptyState message={<Trans>No V2 Liquidity found.</Trans>} />\n          )}\n\n          <AutoColumn justify={'center'} gap=\"md\">\n            <Text textAlign=\"center\" fontSize={14} style={{ padding: '.5rem 0 .5rem 0' }}>\n              <Trans>\n                Don’t see one of your v2 positions?{' '}\n                <StyledInternalLink id=\"import-pool-link\" to={'/find?origin=/migrate/v2'}>\n                  Import it.\n                </StyledInternalLink>\n              </Trans>\n            </Text>\n          </AutoColumn>\n        </AutoColumn>\n      </BodyWrapper>\n      <SwitchLocaleLink />\n    </>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}