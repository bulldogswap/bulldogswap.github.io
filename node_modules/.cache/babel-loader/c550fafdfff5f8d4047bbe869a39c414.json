{"ast":null,"code":"import _slicedToArray from\"/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{i18n}from\"@lingui/core\";import{abi as GOV_ABI}from'@uniswap/governance/build/GovernorAlpha.json';import{CurrencyAmount}from'@uniswap/sdk-core';import{UNISWAP_GRANTS_PROPOSAL_DESCRIPTION}from'constants/proposals/uniswap_grants_proposal_description';import{defaultAbiCoder,formatUnits,Interface,isAddress}from'ethers/lib/utils';import{useGovernanceV0Contract,useGovernanceV1Contract,useLatestGovernanceContract,useUniContract}from'hooks/useContract';import{useActiveWeb3React}from'hooks/web3';import{useCallback,useMemo}from'react';import{calculateGasMargin}from'utils/calculateGasMargin';import{SupportedChainId}from'../../constants/chains';import{UNISWAP_GRANTS_START_BLOCK}from'../../constants/proposals';import{UNI}from'../../constants/tokens';import{useLogs}from'../logs/hooks';import{useSingleCallResult,useSingleContractMultipleData}from'../multicall/hooks';import{useTransactionAdder}from'../transactions/hooks';export var ProposalState;(function(ProposalState){ProposalState[ProposalState[\"UNDETERMINED\"]=-1]=\"UNDETERMINED\";ProposalState[ProposalState[\"PENDING\"]=0]=\"PENDING\";ProposalState[ProposalState[\"ACTIVE\"]=1]=\"ACTIVE\";ProposalState[ProposalState[\"CANCELED\"]=2]=\"CANCELED\";ProposalState[ProposalState[\"DEFEATED\"]=3]=\"DEFEATED\";ProposalState[ProposalState[\"SUCCEEDED\"]=4]=\"SUCCEEDED\";ProposalState[ProposalState[\"QUEUED\"]=5]=\"QUEUED\";ProposalState[ProposalState[\"EXPIRED\"]=6]=\"EXPIRED\";ProposalState[ProposalState[\"EXECUTED\"]=7]=\"EXECUTED\";})(ProposalState||(ProposalState={}));var GovernanceInterface=new Interface(GOV_ABI);// get count of all proposals made in the latest governor contract\nfunction useProposalCount(contract){var _result$;var _useSingleCallResult=useSingleCallResult(contract,'proposalCount'),result=_useSingleCallResult.result;return result===null||result===void 0?void 0:(_result$=result[0])===null||_result$===void 0?void 0:_result$.toNumber();}/**\n * Need proposal events to get description data emitted from\n * new proposal event.\n */function useFormattedProposalCreatedLogs(contract){// create filters for ProposalCreated events\nvar filter=useMemo(function(){var _contract$filters;return contract===null||contract===void 0?void 0:(_contract$filters=contract.filters)===null||_contract$filters===void 0?void 0:_contract$filters.ProposalCreated();},[contract]);var useLogsResult=useLogs(filter);return useMemo(function(){var _useLogsResult$logs;return useLogsResult===null||useLogsResult===void 0?void 0:(_useLogsResult$logs=useLogsResult.logs)===null||_useLogsResult$logs===void 0?void 0:_useLogsResult$logs.map(function(log){var parsed=GovernanceInterface.parseLog(log).args;return{description:parsed.description,details:parsed.targets.map(function(target,i){var signature=parsed.signatures[i];var _signature$substr$spl=signature.substr(0,signature.length-1).split('('),_signature$substr$spl2=_slicedToArray(_signature$substr$spl,2),name=_signature$substr$spl2[0],types=_signature$substr$spl2[1];var calldata=parsed.calldatas[i];var decoded=defaultAbiCoder.decode(types.split(','),calldata);return{target:target,functionSig:name,callData:decoded.join(', ')};})};});},[useLogsResult]);}var V0_PROPOSAL_IDS=[[1],[2],[3],[4]];function countToIndices(count){return typeof count==='number'?new Array(count).fill(0).map(function(_,i){return[i+1];}):[];}// get data for all past and active proposals\nexport function useAllProposalData(){var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId;var gov0=useGovernanceV0Contract();var gov1=useGovernanceV1Contract();var proposalCount0=useProposalCount(gov0);var proposalCount1=useProposalCount(gov1);var gov0ProposalIndexes=useMemo(function(){return chainId===SupportedChainId.MAINNET?V0_PROPOSAL_IDS:countToIndices(proposalCount0);},[chainId,proposalCount0]);var gov1ProposalIndexes=useMemo(function(){return countToIndices(proposalCount1);},[proposalCount1]);var proposalsV0=useSingleContractMultipleData(gov0,'proposals',gov0ProposalIndexes);var proposalsV1=useSingleContractMultipleData(gov1,'proposals',gov1ProposalIndexes);// get all proposal states\nvar proposalStatesV0=useSingleContractMultipleData(gov0,'state',gov0ProposalIndexes);var proposalStatesV1=useSingleContractMultipleData(gov1,'state',gov1ProposalIndexes);// get metadata from past events\nvar formattedLogsV0=useFormattedProposalCreatedLogs(gov0);var formattedLogsV1=useFormattedProposalCreatedLogs(gov1);// early return until events are fetched\nreturn useMemo(function(){var proposalsCallData=proposalsV0.concat(proposalsV1);var proposalStatesCallData=proposalStatesV0.concat(proposalStatesV1);var formattedLogs=(formattedLogsV0!==null&&formattedLogsV0!==void 0?formattedLogsV0:[]).slice(0,proposalsV0.length).concat((formattedLogsV1!==null&&formattedLogsV1!==void 0?formattedLogsV1:[]).slice(0,proposalsV1.length));if(proposalsCallData.some(function(p){return p.loading;})||proposalStatesCallData.some(function(p){return p.loading;})||gov0&&!formattedLogsV0||gov1&&!formattedLogsV1){return{data:[],loading:true};}return{data:proposalsCallData.map(function(proposal,i){var _formattedLogs$i,_proposal$result,_proposal$result$star,_proposal$result2,_description$split$,_description,_description2,_proposal$result3,_proposalStatesCallDa,_proposalStatesCallDa2,_proposalStatesCallDa3,_proposal$result$forV,_proposal$result4,_proposal$result4$for,_proposal$result$agai,_proposal$result5,_proposal$result5$aga,_proposal$result6,_proposal$result6$end,_formattedLogs$i2;var description=(_formattedLogs$i=formattedLogs[i])===null||_formattedLogs$i===void 0?void 0:_formattedLogs$i.description;var startBlock=parseInt(proposal===null||proposal===void 0?void 0:(_proposal$result=proposal.result)===null||_proposal$result===void 0?void 0:(_proposal$result$star=_proposal$result.startBlock)===null||_proposal$result$star===void 0?void 0:_proposal$result$star.toString());if(startBlock===UNISWAP_GRANTS_START_BLOCK){description=UNISWAP_GRANTS_PROPOSAL_DESCRIPTION;}return{id:proposal===null||proposal===void 0?void 0:(_proposal$result2=proposal.result)===null||_proposal$result2===void 0?void 0:_proposal$result2.id.toString(),title:(_description$split$=(_description=description)===null||_description===void 0?void 0:_description.split(/# |\\n/g)[1])!==null&&_description$split$!==void 0?_description$split$:/*i18n*/i18n._(\"Untitled\"),description:(_description2=description)!==null&&_description2!==void 0?_description2:/*i18n*/i18n._(\"No description.\"),proposer:proposal===null||proposal===void 0?void 0:(_proposal$result3=proposal.result)===null||_proposal$result3===void 0?void 0:_proposal$result3.proposer,status:(_proposalStatesCallDa=(_proposalStatesCallDa2=proposalStatesCallData[i])===null||_proposalStatesCallDa2===void 0?void 0:(_proposalStatesCallDa3=_proposalStatesCallDa2.result)===null||_proposalStatesCallDa3===void 0?void 0:_proposalStatesCallDa3[0])!==null&&_proposalStatesCallDa!==void 0?_proposalStatesCallDa:ProposalState.UNDETERMINED,forCount:parseFloat(formatUnits((_proposal$result$forV=proposal===null||proposal===void 0?void 0:(_proposal$result4=proposal.result)===null||_proposal$result4===void 0?void 0:(_proposal$result4$for=_proposal$result4.forVotes)===null||_proposal$result4$for===void 0?void 0:_proposal$result4$for.toString())!==null&&_proposal$result$forV!==void 0?_proposal$result$forV:0,18)),againstCount:parseFloat(formatUnits((_proposal$result$agai=proposal===null||proposal===void 0?void 0:(_proposal$result5=proposal.result)===null||_proposal$result5===void 0?void 0:(_proposal$result5$aga=_proposal$result5.againstVotes)===null||_proposal$result5$aga===void 0?void 0:_proposal$result5$aga.toString())!==null&&_proposal$result$agai!==void 0?_proposal$result$agai:0,18)),startBlock:startBlock,endBlock:parseInt(proposal===null||proposal===void 0?void 0:(_proposal$result6=proposal.result)===null||_proposal$result6===void 0?void 0:(_proposal$result6$end=_proposal$result6.endBlock)===null||_proposal$result6$end===void 0?void 0:_proposal$result6$end.toString()),details:(_formattedLogs$i2=formattedLogs[i])===null||_formattedLogs$i2===void 0?void 0:_formattedLogs$i2.details,governorIndex:i>=gov0ProposalIndexes.length?1:0};}),loading:false};},[formattedLogsV0,formattedLogsV1,gov0,gov0ProposalIndexes.length,gov1,proposalStatesV0,proposalStatesV1,proposalsV0,proposalsV1]);}export function useProposalData(governorIndex,id){var _data$filter;var _useAllProposalData=useAllProposalData(),data=_useAllProposalData.data;return(_data$filter=data.filter(function(p){return p.governorIndex===governorIndex;}))===null||_data$filter===void 0?void 0:_data$filter.find(function(p){return p.id===id;});}// get the users delegatee if it exists\nexport function useUserDelegatee(){var _result$2;var _useActiveWeb3React2=useActiveWeb3React(),account=_useActiveWeb3React2.account;var uniContract=useUniContract();var _useSingleCallResult2=useSingleCallResult(uniContract,'delegates',[account!==null&&account!==void 0?account:undefined]),result=_useSingleCallResult2.result;return(_result$2=result===null||result===void 0?void 0:result[0])!==null&&_result$2!==void 0?_result$2:undefined;}// gets the users current votes\nexport function useUserVotes(){var _useActiveWeb3React3=useActiveWeb3React(),account=_useActiveWeb3React3.account,chainId=_useActiveWeb3React3.chainId;var uniContract=useUniContract();// check for available votes\nvar _useSingleCallResult3=useSingleCallResult(uniContract,'getCurrentVotes',[account!==null&&account!==void 0?account:undefined]),result=_useSingleCallResult3.result,loading=_useSingleCallResult3.loading;return useMemo(function(){var uni=chainId?UNI[chainId]:undefined;return{loading:loading,votes:uni&&result?CurrencyAmount.fromRawAmount(uni,result===null||result===void 0?void 0:result[0]):undefined};},[chainId,loading,result]);}// fetch available votes as of block (usually proposal start block)\nexport function useUserVotesAsOfBlock(block){var _useSingleCallResult4,_useSingleCallResult5;var _useActiveWeb3React4=useActiveWeb3React(),account=_useActiveWeb3React4.account,chainId=_useActiveWeb3React4.chainId;var uniContract=useUniContract();// check for available votes\nvar uni=chainId?UNI[chainId]:undefined;var votes=(_useSingleCallResult4=useSingleCallResult(uniContract,'getPriorVotes',[account!==null&&account!==void 0?account:undefined,block!==null&&block!==void 0?block:undefined]))===null||_useSingleCallResult4===void 0?void 0:(_useSingleCallResult5=_useSingleCallResult4.result)===null||_useSingleCallResult5===void 0?void 0:_useSingleCallResult5[0];return votes&&uni?CurrencyAmount.fromRawAmount(uni,votes):undefined;}export function useDelegateCallback(){var _useActiveWeb3React5=useActiveWeb3React(),account=_useActiveWeb3React5.account,chainId=_useActiveWeb3React5.chainId,library=_useActiveWeb3React5.library;var addTransaction=useTransactionAdder();var uniContract=useUniContract();return useCallback(function(delegatee){var _uniContract$estimate;if(!library||!chainId||!account||!isAddress(delegatee!==null&&delegatee!==void 0?delegatee:''))return undefined;var args=[delegatee];if(!uniContract)throw new Error('No UNI Contract!');return(_uniContract$estimate=uniContract.estimateGas).delegate.apply(_uniContract$estimate,args.concat([{}])).then(function(estimatedGasLimit){return uniContract.delegate.apply(uniContract,args.concat([{value:null,gasLimit:calculateGasMargin(chainId,estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:/*i18n*/i18n._(\"Delegated votes\")});return response.hash;});});},[account,addTransaction,chainId,library,uniContract]);}export function useVoteCallback(){var _useActiveWeb3React6=useActiveWeb3React(),account=_useActiveWeb3React6.account,chainId=_useActiveWeb3React6.chainId;var latestGovernanceContract=useLatestGovernanceContract();var addTransaction=useTransactionAdder();var voteCallback=useCallback(function(proposalId,support){var _latestGovernanceCont;if(!account||!latestGovernanceContract||!proposalId||!chainId)return;var args=[proposalId,support];return(_latestGovernanceCont=latestGovernanceContract.estimateGas).castVote.apply(_latestGovernanceCont,args.concat([{}])).then(function(estimatedGasLimit){return latestGovernanceContract.castVote.apply(latestGovernanceContract,args.concat([{value:null,gasLimit:calculateGasMargin(chainId,estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:\"Voted \".concat(support?'for ':'against',\" proposal \").concat(proposalId)});return response.hash;});});},[account,addTransaction,latestGovernanceContract,chainId]);return{voteCallback:voteCallback};}export function useCreateProposalCallback(){var _useActiveWeb3React7=useActiveWeb3React(),account=_useActiveWeb3React7.account,chainId=_useActiveWeb3React7.chainId;var latestGovernanceContract=useLatestGovernanceContract();var addTransaction=useTransactionAdder();return useCallback(function(createProposalData){var _latestGovernanceCont2;if(!account||!latestGovernanceContract||!createProposalData||!chainId)return undefined;var args=[createProposalData.targets,createProposalData.values,createProposalData.signatures,createProposalData.calldatas,createProposalData.description];return(_latestGovernanceCont2=latestGovernanceContract.estimateGas).propose.apply(_latestGovernanceCont2,args).then(function(estimatedGasLimit){return latestGovernanceContract.propose.apply(latestGovernanceContract,args.concat([{gasLimit:calculateGasMargin(chainId,estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:/*i18n*/i18n._(\"Submitted new proposal\")});return response.hash;});});},[account,addTransaction,latestGovernanceContract,chainId]);}export function useLatestProposalId(address){var _res$result,_res$result$;var govContractV1=useGovernanceV1Contract();var res=useSingleCallResult(govContractV1,'latestProposalIds',[address]);return res===null||res===void 0?void 0:(_res$result=res.result)===null||_res$result===void 0?void 0:(_res$result$=_res$result[0])===null||_res$result$===void 0?void 0:_res$result$.toString();}export function useProposalThreshold(){var _res$result2;var _useActiveWeb3React8=useActiveWeb3React(),chainId=_useActiveWeb3React8.chainId;var latestGovernanceContract=useLatestGovernanceContract();var res=useSingleCallResult(latestGovernanceContract,'proposalThreshold');var uni=chainId?UNI[chainId]:undefined;if((res===null||res===void 0?void 0:(_res$result2=res.result)===null||_res$result2===void 0?void 0:_res$result2[0])&&uni){return CurrencyAmount.fromRawAmount(uni,res.result[0]);}return undefined;}","map":{"version":3,"sources":["/Users/nakanoteppei/Documents/Jupiter/Codes/bulldogswap.github.io/src/state/governance/hooks.ts"],"names":["abi","GOV_ABI","CurrencyAmount","UNISWAP_GRANTS_PROPOSAL_DESCRIPTION","defaultAbiCoder","formatUnits","Interface","isAddress","useGovernanceV0Contract","useGovernanceV1Contract","useLatestGovernanceContract","useUniContract","useActiveWeb3React","useCallback","useMemo","calculateGasMargin","SupportedChainId","UNISWAP_GRANTS_START_BLOCK","UNI","useLogs","useSingleCallResult","useSingleContractMultipleData","useTransactionAdder","ProposalState","GovernanceInterface","useProposalCount","contract","result","toNumber","useFormattedProposalCreatedLogs","filter","filters","ProposalCreated","useLogsResult","logs","map","log","parsed","parseLog","args","description","details","targets","target","i","signature","signatures","substr","length","split","name","types","calldata","calldatas","decoded","decode","functionSig","callData","join","V0_PROPOSAL_IDS","countToIndices","count","Array","fill","_","useAllProposalData","chainId","gov0","gov1","proposalCount0","proposalCount1","gov0ProposalIndexes","MAINNET","gov1ProposalIndexes","proposalsV0","proposalsV1","proposalStatesV0","proposalStatesV1","formattedLogsV0","formattedLogsV1","proposalsCallData","concat","proposalStatesCallData","formattedLogs","slice","some","p","loading","data","proposal","startBlock","parseInt","toString","id","title","proposer","status","UNDETERMINED","forCount","parseFloat","forVotes","againstCount","againstVotes","endBlock","governorIndex","useProposalData","find","useUserDelegatee","account","uniContract","undefined","useUserVotes","uni","votes","fromRawAmount","useUserVotesAsOfBlock","block","useDelegateCallback","library","addTransaction","delegatee","Error","estimateGas","delegate","then","estimatedGasLimit","value","gasLimit","response","summary","hash","useVoteCallback","latestGovernanceContract","voteCallback","proposalId","support","castVote","useCreateProposalCallback","createProposalData","values","propose","useLatestProposalId","address","govContractV1","res","useProposalThreshold"],"mappings":"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","sourcesContent":["import { TransactionResponse } from '@ethersproject/providers'\nimport { t } from '@lingui/macro'\nimport { abi as GOV_ABI } from '@uniswap/governance/build/GovernorAlpha.json'\nimport { CurrencyAmount, Token } from '@uniswap/sdk-core'\nimport { UNISWAP_GRANTS_PROPOSAL_DESCRIPTION } from 'constants/proposals/uniswap_grants_proposal_description'\nimport { Contract } from 'ethers'\nimport { defaultAbiCoder, formatUnits, Interface, isAddress } from 'ethers/lib/utils'\nimport {\n  useGovernanceV0Contract,\n  useGovernanceV1Contract,\n  useLatestGovernanceContract,\n  useUniContract,\n} from 'hooks/useContract'\nimport { useActiveWeb3React } from 'hooks/web3'\nimport { useCallback, useMemo } from 'react'\nimport { calculateGasMargin } from 'utils/calculateGasMargin'\nimport { SupportedChainId } from '../../constants/chains'\nimport { UNISWAP_GRANTS_START_BLOCK } from '../../constants/proposals'\nimport { UNI } from '../../constants/tokens'\nimport { useLogs } from '../logs/hooks'\nimport { useSingleCallResult, useSingleContractMultipleData } from '../multicall/hooks'\nimport { useTransactionAdder } from '../transactions/hooks'\n\ninterface ProposalDetail {\n  target: string\n  functionSig: string\n  callData: string\n}\n\nexport interface ProposalData {\n  id: string\n  title: string\n  description: string\n  proposer: string\n  status: ProposalState\n  forCount: number\n  againstCount: number\n  startBlock: number\n  endBlock: number\n  details: ProposalDetail[]\n  governorIndex: number // index in the governance address array for which this proposal pertains\n}\n\nexport interface CreateProposalData {\n  targets: string[]\n  values: string[]\n  signatures: string[]\n  calldatas: string[]\n  description: string\n}\n\nexport enum ProposalState {\n  UNDETERMINED = -1,\n  PENDING,\n  ACTIVE,\n  CANCELED,\n  DEFEATED,\n  SUCCEEDED,\n  QUEUED,\n  EXPIRED,\n  EXECUTED,\n}\n\nconst GovernanceInterface = new Interface(GOV_ABI)\n\n// get count of all proposals made in the latest governor contract\nfunction useProposalCount(contract: Contract | null): number | undefined {\n  const { result } = useSingleCallResult(contract, 'proposalCount')\n\n  return result?.[0]?.toNumber()\n}\n\ninterface FormattedProposalLog {\n  description: string\n  details: { target: string; functionSig: string; callData: string }[]\n}\n/**\n * Need proposal events to get description data emitted from\n * new proposal event.\n */\nfunction useFormattedProposalCreatedLogs(contract: Contract | null): FormattedProposalLog[] | undefined {\n  // create filters for ProposalCreated events\n  const filter = useMemo(() => contract?.filters?.ProposalCreated(), [contract])\n\n  const useLogsResult = useLogs(filter)\n\n  return useMemo(() => {\n    return useLogsResult?.logs?.map((log) => {\n      const parsed = GovernanceInterface.parseLog(log).args\n      return {\n        description: parsed.description,\n        details: parsed.targets.map((target: string, i: number) => {\n          const signature = parsed.signatures[i]\n          const [name, types] = signature.substr(0, signature.length - 1).split('(')\n          const calldata = parsed.calldatas[i]\n          const decoded = defaultAbiCoder.decode(types.split(','), calldata)\n          return {\n            target,\n            functionSig: name,\n            callData: decoded.join(', '),\n          }\n        }),\n      }\n    })\n  }, [useLogsResult])\n}\n\nconst V0_PROPOSAL_IDS = [[1], [2], [3], [4]]\n\nfunction countToIndices(count: number | undefined) {\n  return typeof count === 'number' ? new Array(count).fill(0).map((_, i) => [i + 1]) : []\n}\n\n// get data for all past and active proposals\nexport function useAllProposalData(): { data: ProposalData[]; loading: boolean } {\n  const { chainId } = useActiveWeb3React()\n  const gov0 = useGovernanceV0Contract()\n  const gov1 = useGovernanceV1Contract()\n\n  const proposalCount0 = useProposalCount(gov0)\n  const proposalCount1 = useProposalCount(gov1)\n\n  const gov0ProposalIndexes = useMemo(() => {\n    return chainId === SupportedChainId.MAINNET ? V0_PROPOSAL_IDS : countToIndices(proposalCount0)\n  }, [chainId, proposalCount0])\n  const gov1ProposalIndexes = useMemo(() => {\n    return countToIndices(proposalCount1)\n  }, [proposalCount1])\n\n  const proposalsV0 = useSingleContractMultipleData(gov0, 'proposals', gov0ProposalIndexes)\n  const proposalsV1 = useSingleContractMultipleData(gov1, 'proposals', gov1ProposalIndexes)\n\n  // get all proposal states\n  const proposalStatesV0 = useSingleContractMultipleData(gov0, 'state', gov0ProposalIndexes)\n  const proposalStatesV1 = useSingleContractMultipleData(gov1, 'state', gov1ProposalIndexes)\n\n  // get metadata from past events\n  const formattedLogsV0 = useFormattedProposalCreatedLogs(gov0)\n  const formattedLogsV1 = useFormattedProposalCreatedLogs(gov1)\n\n  // early return until events are fetched\n  return useMemo(() => {\n    const proposalsCallData = proposalsV0.concat(proposalsV1)\n    const proposalStatesCallData = proposalStatesV0.concat(proposalStatesV1)\n    const formattedLogs = (formattedLogsV0 ?? [])\n      .slice(0, proposalsV0.length)\n      .concat((formattedLogsV1 ?? []).slice(0, proposalsV1.length))\n\n    if (\n      proposalsCallData.some((p) => p.loading) ||\n      proposalStatesCallData.some((p) => p.loading) ||\n      (gov0 && !formattedLogsV0) ||\n      (gov1 && !formattedLogsV1)\n    ) {\n      return { data: [], loading: true }\n    }\n\n    return {\n      data: proposalsCallData.map((proposal, i) => {\n        let description = formattedLogs[i]?.description\n        const startBlock = parseInt(proposal?.result?.startBlock?.toString())\n        if (startBlock === UNISWAP_GRANTS_START_BLOCK) {\n          description = UNISWAP_GRANTS_PROPOSAL_DESCRIPTION\n        }\n        return {\n          id: proposal?.result?.id.toString(),\n          title: description?.split(/# |\\n/g)[1] ?? t`Untitled`,\n          description: description ?? t`No description.`,\n          proposer: proposal?.result?.proposer,\n          status: proposalStatesCallData[i]?.result?.[0] ?? ProposalState.UNDETERMINED,\n          forCount: parseFloat(formatUnits(proposal?.result?.forVotes?.toString() ?? 0, 18)),\n          againstCount: parseFloat(formatUnits(proposal?.result?.againstVotes?.toString() ?? 0, 18)),\n          startBlock,\n          endBlock: parseInt(proposal?.result?.endBlock?.toString()),\n          details: formattedLogs[i]?.details,\n          governorIndex: i >= gov0ProposalIndexes.length ? 1 : 0,\n        }\n      }),\n      loading: false,\n    }\n  }, [\n    formattedLogsV0,\n    formattedLogsV1,\n    gov0,\n    gov0ProposalIndexes.length,\n    gov1,\n    proposalStatesV0,\n    proposalStatesV1,\n    proposalsV0,\n    proposalsV1,\n  ])\n}\n\nexport function useProposalData(governorIndex: number, id: string): ProposalData | undefined {\n  const { data } = useAllProposalData()\n  return data.filter((p) => p.governorIndex === governorIndex)?.find((p) => p.id === id)\n}\n\n// get the users delegatee if it exists\nexport function useUserDelegatee(): string {\n  const { account } = useActiveWeb3React()\n  const uniContract = useUniContract()\n  const { result } = useSingleCallResult(uniContract, 'delegates', [account ?? undefined])\n  return result?.[0] ?? undefined\n}\n\n// gets the users current votes\nexport function useUserVotes(): { loading: boolean; votes: CurrencyAmount<Token> | undefined } {\n  const { account, chainId } = useActiveWeb3React()\n  const uniContract = useUniContract()\n\n  // check for available votes\n  const { result, loading } = useSingleCallResult(uniContract, 'getCurrentVotes', [account ?? undefined])\n  return useMemo(() => {\n    const uni = chainId ? UNI[chainId] : undefined\n    return { loading, votes: uni && result ? CurrencyAmount.fromRawAmount(uni, result?.[0]) : undefined }\n  }, [chainId, loading, result])\n}\n\n// fetch available votes as of block (usually proposal start block)\nexport function useUserVotesAsOfBlock(block: number | undefined): CurrencyAmount<Token> | undefined {\n  const { account, chainId } = useActiveWeb3React()\n  const uniContract = useUniContract()\n\n  // check for available votes\n  const uni = chainId ? UNI[chainId] : undefined\n  const votes = useSingleCallResult(uniContract, 'getPriorVotes', [account ?? undefined, block ?? undefined])\n    ?.result?.[0]\n  return votes && uni ? CurrencyAmount.fromRawAmount(uni, votes) : undefined\n}\n\nexport function useDelegateCallback(): (delegatee: string | undefined) => undefined | Promise<string> {\n  const { account, chainId, library } = useActiveWeb3React()\n  const addTransaction = useTransactionAdder()\n\n  const uniContract = useUniContract()\n\n  return useCallback(\n    (delegatee: string | undefined) => {\n      if (!library || !chainId || !account || !isAddress(delegatee ?? '')) return undefined\n      const args = [delegatee]\n      if (!uniContract) throw new Error('No UNI Contract!')\n      return uniContract.estimateGas.delegate(...args, {}).then((estimatedGasLimit) => {\n        return uniContract\n          .delegate(...args, { value: null, gasLimit: calculateGasMargin(chainId, estimatedGasLimit) })\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: t`Delegated votes`,\n            })\n            return response.hash\n          })\n      })\n    },\n    [account, addTransaction, chainId, library, uniContract]\n  )\n}\n\nexport function useVoteCallback(): {\n  voteCallback: (proposalId: string | undefined, support: boolean) => undefined | Promise<string>\n} {\n  const { account, chainId } = useActiveWeb3React()\n\n  const latestGovernanceContract = useLatestGovernanceContract()\n\n  const addTransaction = useTransactionAdder()\n\n  const voteCallback = useCallback(\n    (proposalId: string | undefined, support: boolean) => {\n      if (!account || !latestGovernanceContract || !proposalId || !chainId) return\n      const args = [proposalId, support]\n      return latestGovernanceContract.estimateGas.castVote(...args, {}).then((estimatedGasLimit) => {\n        return latestGovernanceContract\n          .castVote(...args, { value: null, gasLimit: calculateGasMargin(chainId, estimatedGasLimit) })\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: `Voted ${support ? 'for ' : 'against'} proposal ${proposalId}`,\n            })\n            return response.hash\n          })\n      })\n    },\n    [account, addTransaction, latestGovernanceContract, chainId]\n  )\n  return { voteCallback }\n}\n\nexport function useCreateProposalCallback(): (\n  createProposalData: CreateProposalData | undefined\n) => undefined | Promise<string> {\n  const { account, chainId } = useActiveWeb3React()\n\n  const latestGovernanceContract = useLatestGovernanceContract()\n  const addTransaction = useTransactionAdder()\n\n  return useCallback(\n    (createProposalData: CreateProposalData | undefined) => {\n      if (!account || !latestGovernanceContract || !createProposalData || !chainId) return undefined\n\n      const args = [\n        createProposalData.targets,\n        createProposalData.values,\n        createProposalData.signatures,\n        createProposalData.calldatas,\n        createProposalData.description,\n      ]\n\n      return latestGovernanceContract.estimateGas.propose(...args).then((estimatedGasLimit) => {\n        return latestGovernanceContract\n          .propose(...args, { gasLimit: calculateGasMargin(chainId, estimatedGasLimit) })\n          .then((response: TransactionResponse) => {\n            addTransaction(response, {\n              summary: t`Submitted new proposal`,\n            })\n            return response.hash\n          })\n      })\n    },\n    [account, addTransaction, latestGovernanceContract, chainId]\n  )\n}\n\nexport function useLatestProposalId(address: string | undefined): string | undefined {\n  const govContractV1 = useGovernanceV1Contract()\n  const res = useSingleCallResult(govContractV1, 'latestProposalIds', [address])\n\n  return res?.result?.[0]?.toString()\n}\n\nexport function useProposalThreshold(): CurrencyAmount<Token> | undefined {\n  const { chainId } = useActiveWeb3React()\n\n  const latestGovernanceContract = useLatestGovernanceContract()\n  const res = useSingleCallResult(latestGovernanceContract, 'proposalThreshold')\n  const uni = chainId ? UNI[chainId] : undefined\n\n  if (res?.result?.[0] && uni) {\n    return CurrencyAmount.fromRawAmount(uni, res.result[0])\n  }\n\n  return undefined\n}\n"]},"metadata":{},"sourceType":"module"}